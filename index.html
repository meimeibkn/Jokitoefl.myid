<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <title>Jokitoefl.myid</title>

  <style>
    :root{
      --navy:#002D5F;
      --sky:#A1C0F8;
      --black:#000;
      --white:#fff;
      --muted: rgba(255,255,255,.75);
      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.04);
      --line: rgba(161,192,248,.18);
      --shadow: rgba(0,0,0,.35);
      --maxw:1100px;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
      background:
        radial-gradient(1000px 520px at 18% 6%, rgba(161,192,248,.18), transparent 55%),
        radial-gradient(1000px 620px at 88% 10%, rgba(161,192,248,.10), transparent 55%),
        linear-gradient(180deg, rgba(0,0,0,.65), rgba(0,0,0,.45)),
        var(--navy);
      color:var(--white);
    }

    a{color:inherit}
    .wrap{max-width:var(--maxw); margin:0 auto; padding:0 18px;}
    @media (max-width:720px){ .wrap{padding:0 16px;} }

    /* NAV */
    .nav{
      position:sticky; top:0; z-index:40;
      background: rgba(0,0,0,.18);
      backdrop-filter: blur(10px);
      border-bottom:1px solid rgba(161,192,248,.10);
    }
    .navRow{display:flex; align-items:center; justify-content:space-between; gap:14px; padding:12px 0;}
    .brand{display:flex; align-items:center; gap:10px; text-decoration:none;}
    .logoBox{
      width:34px; height:34px; border-radius:10px;
      background: rgba(255,255,255,.08);
      border:1px solid rgba(161,192,248,.18);
      display:grid; place-items:center;
      overflow:hidden;
    }
    .logoBox img{width:100%; height:100%; object-fit:cover; display:block}
    .brandText{display:flex; flex-direction:column; line-height:1.1}
    .brandName{font-weight:900; font-size:14px}
    .brandTag{font-size:12px; color:rgba(255,255,255,.70)}
    .navLinks{display:flex; gap:14px; flex-wrap:wrap; align-items:center; justify-content:flex-end}
    .navLinks a{
      text-decoration:none;
      font-size:13px;
      color:rgba(255,255,255,.82);
      padding:8px 10px;
      border-radius:12px;
    }
    .navLinks a:hover{background: rgba(255,255,255,.06)}
    @media (max-width:860px){
      .brandTag{display:none}
      .navLinks{gap:8px}
      .navLinks a{padding:8px 8px}
    }

    /* BUTTONS */
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid rgba(161,192,248,.25);
      background: rgba(255,255,255,.06);
      color:rgba(255,255,255,.90);
      text-decoration:none;
      font-weight:800;
      font-size:13px;
      cursor:pointer;
      user-select:none;
    }
    .btn:hover{border-color:rgba(161,192,248,.38); background: rgba(161,192,248,.08)}
    .btn.primary{
      background: rgba(161,192,248,.18);
      border-color: rgba(161,192,248,.42);
      color:#fff;
    }
    .btn.primary:hover{background: rgba(161,192,248,.22)}
    .btn.sm{padding:8px 12px; font-size:12px}

    /* HERO */
    .hero{padding:18px 0 8px; display:flex}
    .heroInner{width:100%; max-width:780px}
    .title{font-size:44px; line-height:1.05; letter-spacing:-.8px; margin:14px 0 0}
    .accent{color:var(--sky)}
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 12px; border-radius:999px;
      border:1px solid rgba(161,192,248,.28);
      background: rgba(161,192,248,.10);
      color: rgba(255,255,255,.85);
      font-size:12px; margin:10px 0 0;
    }
    .subhead{margin-top:12px; color:var(--muted); line-height:1.7}
    .heroActions{display:flex; gap:10px; flex-wrap:wrap; margin-top:16px}
    @media (max-width:720px){ .title{font-size:36px} .heroInner{max-width:100%} }

    /* SECTION */
    section{padding:18px 0}
    .secHead{display:flex; justify-content:space-between; align-items:baseline; gap:10px; margin-bottom:12px}
    h2{margin:0; font-size:20px; letter-spacing:-.2px}
    .small{font-size:12px; color:rgba(255,255,255,.68)}

    .card{
      border:1px solid rgba(161,192,248,.16);
      background: rgba(255,255,255,.05);
      border-radius:18px;
      padding:16px;
      box-shadow: 0 18px 44px rgba(0,0,0,.22);
    }

    /* ABOUT */
    .aboutCard .cardText{margin:0; color:rgba(255,255,255,.82); line-height:1.8}

    /* SERVICES */
    .svcGrid{display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); gap:14px}
    @media (max-width:860px){ .svcGrid{grid-template-columns:1fr} }
    .svcCard{cursor:pointer; transition:transform .12s ease}
    .svcCard:hover{transform: translateY(-1px); border-color: rgba(161,192,248,.28)}
    .svcTitle{margin:0 0 8px; font-size:16px; font-weight:900}
    .svcDesc{margin:0; color:rgba(255,255,255,.78); line-height:1.7}

    /* ADVANTAGES (grid cards seperti yang kamu mau) */
    .advGrid{display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); gap:14px}
    @media (max-width:860px){ .advGrid{grid-template-columns:1fr} }
    .advTitle{margin:0 0 8px; font-weight:900}
    .advText{margin:0; color:rgba(255,255,255,.78); line-height:1.7}

    /* TESTIMONIAL TEXT slider */
    .tWrap{overflow:hidden}
    .tTrack{display:flex; gap:14px; will-change:transform; transition:transform .18s ease}
    .tCard{
      flex:0 0 calc((100% - 28px)/3); /* 3 cards wide, terlihat 2.5-ish tergantung viewport */
      border:1px solid rgba(161,192,248,.14);
      border-radius:18px;
      background: rgba(255,255,255,.05);
      padding:14px;
      min-height:120px;
    }
    @media (max-width:980px){ .tCard{flex-basis: calc((100% - 14px)/2)} }
    @media (max-width:640px){ .tCard{flex-basis: 100%} }
    .tName{font-weight:900; font-size:13px; margin-bottom:8px}
    .tText{margin:0; color:rgba(255,255,255,.78); line-height:1.7}
    .tControls{display:flex; gap:10px; align-items:center; margin-top:12px}
    .tHint{font-size:12px; color:rgba(255,255,255,.68)}

    /* TESTIMONIAL IMAGES (besar kiri, thumbnails kanan) */
    .gGrid{display:grid; grid-template-columns: 1.4fr .9fr; gap:14px}
    @media (max-width:980px){ .gGrid{grid-template-columns:1fr} }
    .gMain{
      border:1px solid rgba(161,192,248,.14);
      background: rgba(255,255,255,.04);
      border-radius:18px;
      padding:10px;
      overflow:hidden;
      cursor:pointer;
      min-height:320px;
      display:flex; align-items:center; justify-content:center;
    }
    .gMain img{
      width:100%;
      max-height:420px;
      object-fit:contain;
      display:block;
      border-radius:14px;
    }
    .gSide{
      border:1px solid rgba(161,192,248,.14);
      background: rgba(255,255,255,.04);
      border-radius:18px;
      padding:10px;
    }
    .thumbRow{
      display:flex; gap:10px;
      overflow:auto;
      padding-bottom:8px;
      scroll-snap-type:x mandatory;
    }
    .thumbRow::-webkit-scrollbar{height:10px}
    .thumbRow::-webkit-scrollbar-thumb{background: rgba(255,255,255,.18); border-radius:999px}
    .thumb{
      flex:0 0 110px;
      height:84px;
      border-radius:14px;
      border:1px solid rgba(161,192,248,.12);
      background: rgba(0,0,0,.18);
      overflow:hidden;
      cursor:pointer;
      scroll-snap-align:start;
      display:flex; align-items:center; justify-content:center;
    }
    .thumb img{width:100%; height:100%; object-fit:cover; display:block}
    .gCap{margin-top:10px; font-size:12px; color:rgba(255,255,255,.75)}

    /* CONTACT FORM (main) */
    .formCard{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .formCard .full{grid-column:1/-1}
    @media (max-width:820px){ .formCard{grid-template-columns:1fr} }
    label{display:block; font-size:12px; color: rgba(255,255,255,.72); margin:0 0 6px}
    input, select, textarea{
      width:100%;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(161,192,248,.16);
      border-radius: 14px;
      padding:12px 12px;
      color: #fff;
      outline:none;
      font-size:14px;
    }
    textarea{min-height:110px; resize:vertical}
    input:focus, select:focus, textarea:focus{border-color: rgba(161,192,248,.36); background: rgba(161,192,248,.06)}
    .hint{margin-top:10px; font-size:13px; color: rgba(255,255,255,.70); line-height:1.6}
    .formActions{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-top:10px}

    /* MODAL */
    .overlay{
      position:fixed; inset:0; z-index:70;
      background: rgba(0,0,0,.45);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
    }
    .modal{
      width:min(900px, 96vw);
      background: rgba(7,20,38,.96);
      border:1px solid rgba(161,192,248,.20);
      border-radius: 18px;
      box-shadow: 0 30px 80px rgba(0,0,0,.55);
      padding:16px;
    }
    .modalTop{display:flex; align-items:flex-start; justify-content:space-between; gap:12px}
    .modalTitle{margin:0; font-size:18px; font-weight:900}
    .modalDesc{margin:6px 0 0; color:rgba(255,255,255,.78); line-height:1.7}
    .modalBody{margin-top:12px; border-top:1px solid rgba(255,255,255,.08); padding-top:12px}
    .modalSection{margin:12px 0}
    .modalBadge{
      display:inline-flex;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(161,192,248,.28);
      background: rgba(161,192,248,.10);
      font-size:12px;
      font-weight:900;
      margin-bottom:8px;
    }
    .modalBody ul{margin:6px 0 0 18px}
    .modalBody li{margin:6px 0; color:rgba(255,255,255,.82); line-height:1.7}
    .modalActions{display:flex; gap:10px; margin-top:14px; flex-wrap:wrap}

    /* IMAGE POPUP */
    .imgModal{
      width:min(900px, 96vw);
      background: rgba(7,20,38,.96);
      border:1px solid rgba(161,192,248,.20);
      border-radius: 18px;
      box-shadow: 0 30px 80px rgba(0,0,0,.55);
      padding:12px;
    }
    .imgTop{display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:10px}
    .imgViewer{
      width:100%;
      height:min(70vh, 560px);
      border-radius:14px;
      background: rgba(0,0,0,.30);
      border:1px solid rgba(161,192,248,.14);
      display:flex; align-items:center; justify-content:center;
      overflow:hidden;
    }
    .imgViewer img{max-width:100%; max-height:100%; object-fit:contain; display:block}
    .imgCap{margin-top:10px; font-size:12px; color:rgba(255,255,255,.78)}
    .imgActions{display:flex; gap:10px; margin-top:10px; justify-content:flex-end; flex-wrap:wrap}

    /* ADMIN FAB (owner) */
    .adminFab{
      position:fixed; right:14px; bottom:14px; z-index:60;
      width:44px; height:44px; border-radius:999px;
      display:grid; place-items:center;
      background: rgba(161,192,248,.18);
      border:1px solid rgba(161,192,248,.30);
      box-shadow: 0 18px 44px rgba(0,0,0,.35);
      cursor:pointer;
    }
    .adminFab:hover{background: rgba(161,192,248,.22)}
    .adminFab span{font-weight:900}

    /* TIPS VIEW */
    .tipsView{padding:18px 0 18px;}
    .tipsTop{display:flex; align-items:center; gap:12px; margin:6px 0 14px; flex-wrap:wrap}
    .tipsTop .h2{margin:0; font-size:20px}
    .tipsList{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:14px}
    @media (max-width:860px){.tipsList{grid-template-columns:1fr}}
    .tipsCard{
      cursor:pointer;
      border:1px solid rgba(255,255,255,.10);
      border-radius:18px;
      background:rgba(255,255,255,.06);
      padding:14px;
      box-shadow:0 10px 28px rgba(0,0,0,.18);
    }
    .tipsCard:hover{border-color:rgba(161,192,248,.35)}
    .tipsCardTitle{font-weight:900; font-size:16px; margin:0 0 8px}
    .tipsCardPrev{color:rgba(255,255,255,.78); line-height:1.6; margin:0}
    .tipsArticle{
      background:#fff;
      color:#0b1220;
      border-radius:18px;
      padding:18px;
      box-shadow:0 18px 60px rgba(0,0,0,.25);
    }
    .tipsArticle h1{font-size:26px; margin:0 0 10px}
    .tipsArticle .meta{color:#334155; font-size:12px; margin-bottom:12px}
    .tipsArticle p{line-height:1.8; margin:10px 0}
    .tipsArticle h2{font-size:18px; margin:18px 0 8px}
    .tipsArticle ul{margin:8px 0 10px 18px}
    .tipsArticle li{margin:6px 0; line-height:1.7}
    .tipsCover{
      width:100%;
      border-radius:14px;
      margin:10px 0 14px;
      display:block;
      max-height:360px;
      object-fit:cover;
    }
    .relatedBox{
      margin-top:18px;
      border:1px solid rgba(0,0,0,.10);
      border-radius:12px;
      padding:12px 14px;
      background:#f6fbff;
    }
    .relatedBoxTitle{font-weight:900; margin:0 0 10px; font-size:14px; color:#0b1220}
    .relatedBox ul{margin:0 0 0 18px}
    .relatedBox a{color:#0b4aa0; text-decoration:none}
    .relatedBox a:hover{text-decoration:underline}

    /* Tips footer form (tidak overlay, muncul di bawah konten) */
    .tipsFooter{
      margin-top:16px;
      border:1px solid rgba(161,192,248,.16);
      background: rgba(255,255,255,.05);
      border-radius:18px;
      padding:16px;
      box-shadow: 0 18px 44px rgba(0,0,0,.22);
    }
    .tipsFooterTop{display:flex; align-items:baseline; justify-content:space-between; gap:12px; flex-wrap:wrap; margin-bottom:10px}
    .tipsFooterTop .h3{margin:0; font-size:18px; font-weight:900}

    /* TOAST */
    .toast{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:22px; z-index:90;
      background: rgba(7,20,38,.96);
      border:1px solid rgba(161,192,248,.22);
      padding:10px 12px;
      border-radius: 14px;
      color: rgba(255,255,255,.90);
      display:none;
      box-shadow: 0 18px 44px rgba(0,0,0,.35);
      max-width:min(760px, 92vw);
      font-size:13px;
    }

    footer{padding:22px 0 40px; color:rgba(255,255,255,.60); font-size:12px}
  </style>
</head>

<body>
  <!-- NAV -->
  <div class="nav" id="top">
    <div class="wrap">
      <div class="navRow">
        <a class="brand" href="#home">
          <div class="logoBox" id="logoBox">
            <img id="logoImg" alt="" hidden />
          </div>
          <div class="brandText">
            <div class="brandName" id="siteName">Jokitoefl.myid</div>
            <div class="brandTag" id="tagline">One stop for your future</div>
          </div>
        </a>

        <div class="navLinks" id="navLinks">
          <a href="#home">Home</a>
          <a href="#about">About Us</a>
          <a href="#layanan">Layanan</a>
          <a href="#testimoni">Testimoni</a>
          <a href="#tips">Tips</a>
          <a href="#kontak">Kontak</a>
        </div>
      </div>
    </div>
  </div>

  <!-- MAIN SITE -->
  <main id="mainSite">
    <div class="wrap">
      <!-- HERO -->
      <section id="home" class="hero">
        <div class="heroInner">
          <h1 class="title" id="headline">One stop for your <span class="accent">future</span></h1>
          <div class="badge" id="heroBadge">Sertifikat TOEFL & Komputer • Bantuan Mahasiswa • Lainnya</div>
          <p class="subhead" id="subhead"></p>

          <div class="heroActions">
            <a class="btn primary" href="#kontak" id="ctaHero">Konsultasi Gratis</a>
            <a class="btn" href="#layanan">Lihat Layanan</a>
            <a class="btn" id="igBtn" target="_blank" rel="noreferrer">Instagram</a>
            <a class="btn" href="#tips" id="tipsBtn">Tips Gratis</a>
          </div>
        </div>
      </section>

      <!-- ABOUT -->
      <section id="about">
        <div class="secHead">
          <h2 id="aboutTitle">Tentang Kami</h2>
        </div>
        <div class="card aboutCard">
          <p class="cardText" id="aboutText"></p>
        </div>
      </section>

      <!-- SERVICES -->
      <section id="layanan">
        <div class="secHead">
          <h2>Layanan</h2>
          <div class="small">Klik card untuk lihat detail.</div>
        </div>
        <div class="svcGrid" id="svcGrid"></div>
      </section>

      <!-- ADVANTAGES -->
      <section id="keunggulan">
        <div class="secHead">
          <h2>Keunggulan</h2>
          <div class="small" id="advantagesHint">Kenapa banyak yang cocok di sini.</div>
        </div>
        <div class="advGrid" id="advantagesGrid"></div>
      </section>

      <!-- TESTIMONI -->
      <section id="testimoni">
        <div class="secHead">
          <h2>Testimoni</h2>
          <div class="small">Testimoni Customer Kami.</div>
        </div>

        <div class="card">
          <div class="small" style="margin-bottom:10px;font-weight:900;color:rgba(255,255,255,.84)">Teks</div>
          <div class="tWrap">
            <div class="tTrack" id="tTrack"></div>
          </div>
          <div class="tControls">
            <button class="btn sm" id="tPrev">‹</button>
            <button class="btn sm" id="tNext">›</button>
            <div class="tHint">Geser atau klik tombol. Manual, tanpa blur.</div>
          </div>

          <div style="height:14px"></div>

          <div class="small" style="margin-bottom:10px;font-weight:900;color:rgba(255,255,255,.84)">Gambar</div>
          <div class="gGrid">
            <div class="gMain" id="gMain">
              <img id="gMainImg" alt="" />
            </div>
            <div class="gSide">
              <div class="small" style="margin-bottom:8px">Thumbnails (4–6 terlihat, geser untuk sisanya)</div>
              <div class="thumbRow" id="thumbRow"></div>
              <div class="gCap" id="gCap"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- CONTACT -->
      <section id="kontak">
        <div class="secHead">
          <h2>Kontak</h2>
          <div class="small">Isi form, nanti kami hubungi via WhatsApp.</div>
        </div>

        <div class="card">
          <form id="contactForm">
            <div class="formCard">
              <div>
                <label>Nama</label>
                <input name="name" placeholder="Nama kamu" required />
              </div>
              <div>
                <label>No WhatsApp</label>
                <input name="whatsapp" placeholder="08xxxxxxxxxx" required />
              </div>
              <div class="full">
                <label>Layanan</label>
                <select name="service" id="serviceSelect" required></select>
              </div>
              <div class="full">
                <label>Catatan (opsional)</label>
                <textarea name="note" id="noteField" placeholder="Catatan (opsional): Harga, durasi kelas, deadline, dll"></textarea>
              </div>
            </div>

            <div class="formActions">
              <button class="btn primary" type="submit">Kirim</button>
              <div class="small" id="formMsg">Setelah kamu kirim, kami akan hubungi lewat WhatsApp.</div>
            </div>
          </form>
        </div>
      </section>

      <footer>
        © <span id="year"></span> Jokitoefl.myid. All rights reserved.
      </footer>
    </div>
  </main>

  <!-- TIPS VIEW -->
  <section id="tipsView" class="tipsView" hidden>
    <div class="wrap">
      <div class="tipsTop">
        <button class="btn" id="tipsBackBtn">← Kembali</button>
        <button class="btn primary" id="tipsCtaBtn">Konsultasi Gratis</button>
        <h2 class="h2">Tips Gratis</h2>
      </div>

      <div id="tipsList" class="tipsList"></div>
      <article id="tipsArticle" class="tipsArticle" hidden></article>

      <!-- Form versi “tidak ganggu”: tampil di bawah konten tips -->
      <div class="tipsFooter" id="tipsFooter">
        <div class="tipsFooterTop">
          <h3 class="h3">Kontak</h3>
          <div class="small">Isi form, nanti kami hubungi via WhatsApp.</div>
        </div>

        <form id="tipsForm">
          <div class="formCard">
            <div>
              <label>Nama</label>
              <input name="name" placeholder="Nama kamu" required />
            </div>
            <div>
              <label>No WhatsApp</label>
              <input name="whatsapp" placeholder="08xxxxxxxxxx" required />
            </div>
            <div class="full">
              <label>Layanan</label>
              <select name="service" id="tipsServiceSelect" required></select>
            </div>
            <div class="full">
              <label>Catatan (opsional)</label>
              <textarea name="note" id="tipsNote" placeholder="Catatan (opsional): Harga, durasi kelas, deadline, dll"></textarea>
            </div>
          </div>

          <div class="formActions">
            <button class="btn primary" type="submit">Kirim</button>
            <div class="small" id="tipsFormMsg">Setelah kamu kirim, kami akan hubungi lewat WhatsApp.</div>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- MODALS -->
  <div class="overlay" id="overlay">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="mTitle">
      <div class="modalTop">
        <div>
          <h3 class="modalTitle" id="mTitle"></h3>
          <div class="modalDesc" id="mDesc"></div>
        </div>
        <button class="btn sm" id="mClose">Tutup</button>
      </div>
      <div class="modalBody" id="mBody"></div>
      <div class="modalActions">
        <a class="btn primary" href="#kontak">Konsultasi Gratis</a>
        <a class="btn" href="#kontak">Isi Form Sekarang</a>
      </div>
    </div>
  </div>

  <div class="overlay" id="imgOverlay">
    <div class="imgModal" role="dialog" aria-modal="true">
      <div class="imgTop">
        <div class="small" id="imgTopTitle">Testimoni</div>
        <button class="btn sm" id="imgClose">Tutup</button>
      </div>
      <div class="imgViewer">
        <img id="imgBig" alt="" />
      </div>
      <div class="imgCap" id="imgCaption"></div>
      <div class="imgActions">
        <button class="btn sm" id="imgPrev">Prev</button>
        <button class="btn sm" id="imgNext">Next</button>
      </div>
    </div>
  </div>

  <!-- OWNER-ONLY ADMIN FAB (local only, no password in repo) -->
  <div class="adminFab" id="adminFab" title="Admin">
    <span>⚙</span>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ===== Helpers
    const $ = (id)=>document.getElementById(id);

    function safeText(s){
      return (s ?? "").toString()
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#039;");
    }

    function toast(msg, type){
      const el = $("toast");
      if(!el) return;
      el.textContent = msg;
      el.style.display = "block";
      el.style.borderColor = type === "bad" ? "rgba(255,120,120,.35)" : "rgba(161,192,248,.22)";
      setTimeout(()=>{ el.style.display="none"; }, 2400);
    }

    // ===== Load data.json (no cache)
    async function fetchRemote(){
      try{
        const res = await fetch("data.json?ts=" + Date.now(), { cache:"no-store" });
        if(!res.ok) return null;
        return await res.json();
      }catch(e){
        console.error(e);
        return null;
      }
    }

    // ===== Apply theme/settings
    function applySettings(d){
      const s = d?.settings || {};
      document.documentElement.style.setProperty("--maxw", (s.maxWidth || 1100) + "px");

      const theme = s.theme || {};
      if(theme.navy) document.documentElement.style.setProperty("--navy", theme.navy);
      if(theme.accent) document.documentElement.style.setProperty("--sky", theme.accent);
      if(theme.black) document.documentElement.style.setProperty("--black", theme.black);
      if(theme.white) document.documentElement.style.setProperty("--white", theme.white);

      $("siteName").textContent = s.siteName || "Jokitoefl.myid";
      $("tagline").textContent = s.headline || "One stop for your future";

      // Headline highlight (only word)
      const hl = s.headline || "One stop for your future";
      const word = s.highlightWord || "future";
      const re = new RegExp("\\b" + word.replace(/[.*+?^${}()|[\]\\]/g, "\\$&") + "\\b", "i");
      const out = hl.replace(re, (m)=>`<span class="accent">${safeText(m)}</span>`);
      $("headline").innerHTML = safeText(hl) === hl ? out : hl; // fallback

      $("heroBadge").textContent = s.heroBadge || "";
      $("subhead").textContent = s.subhead || "";
      $("ctaHero").textContent = s.ctaText || "Konsultasi Gratis";

      const ig = s.instagram || "#";
      const igBtn = $("igBtn");
      igBtn.href = ig;
    }

    function applyLogo(d){
      const img = $("logoImg");
      const box = $("logoBox");
      const s = d?.settings || {};
      const logoSrc = s?.logo?.src || "";
      const alt = s?.logo?.alt || ""; // kalau kamu kosongkan di json, dia kosong
      if(logoSrc){
        img.src = logoSrc;
        img.alt = alt;
        img.hidden = false;
        box.style.background = "transparent";
      }else{
        img.hidden = true;
      }
    }

    // ===== Render About
    function renderAbout(d){
      const a = d?.about || {};
      $("aboutTitle").textContent = a.title || "Tentang Kami";
      $("aboutText").textContent = a.text || "";
    }

    // ===== Render Services + Modal Details (SECTION badges)
    function renderServices(d){
      const grid = $("svcGrid");
      const arr = Array.isArray(d.services) ? d.services : [];
      grid.innerHTML = "";

      if(!arr.length){
        grid.innerHTML = `<div class="small">Belum ada data layanan.</div>`;
        return;
      }

      arr.forEach(svc=>{
        const card = document.createElement("div");
        card.className = "card svcCard";
        card.innerHTML = `
          <h3 class="svcTitle">${safeText(svc.title || "")}</h3>
          <p class="svcDesc">${safeText(svc.desc || "")}</p>
        `;
        card.addEventListener("click", ()=> openServiceModal(svc));
        grid.appendChild(card);
      });
    }

    function openServiceModal(svc){
      $("mTitle").textContent = svc?.title || "";
      $("mDesc").textContent = svc?.desc || "";
      const body = $("mBody");
      body.innerHTML = "";

      const details = Array.isArray(svc?.details) ? svc.details : [];

      // CASE A: details = array of strings, parse "SECTION:"
      if(details.length && typeof details[0] === "string"){
        const lines = details.map(x => (x ?? "").toString().trim()).filter(Boolean);

        const sections = [];
        let current = { title:"", items:[] };

        lines.forEach(line=>{
          if(line.toUpperCase().startsWith("SECTION:")){
            if(current.title || current.items.length) sections.push(current);
            current = { title: line.replace(/^SECTION:\s*/i,"").trim(), items:[] };
          }else{
            current.items.push(line);
          }
        });
        if(current.title || current.items.length) sections.push(current);

        sections.forEach(sec=>{
          const div = document.createElement("div");
          div.className = "modalSection";
          const badge = sec.title ? `<div class="modalBadge">${safeText(sec.title)}</div>` : "";
          div.innerHTML = `${badge}<ul>${sec.items.map(x=>`<li>${safeText(x)}</li>`).join("")}</ul>`;
          body.appendChild(div);
        });
      }
      // CASE B: details = array of section objects
      else if(details.length && typeof details[0] === "object"){
        details.forEach(section=>{
          const div = document.createElement("div");
          div.className = "modalSection";
          const items = (section.items || []).map(x=>`<li>${safeText(x)}</li>`).join("");
          const badge = section.title ? `<div class="modalBadge">${safeText(section.title)}</div>` : "";
          div.innerHTML = `${badge}<ul>${items}</ul>`;
          body.appendChild(div);
        });
      }else{
        body.innerHTML = `<div class="small">Belum ada detail.</div>`;
      }

      $("overlay").style.display = "flex";
    }

    $("mClose").addEventListener("click", ()=> $("overlay").style.display="none");
    $("overlay").addEventListener("click", (e)=>{ if(e.target.id==="overlay") $("overlay").style.display="none"; });

    // ===== Render Advantages
    function renderAdvantages(d){
      const wrap = $("advantagesGrid");
      const arr = Array.isArray(d.advantages) ? d.advantages : [];
      wrap.innerHTML = "";

      if(!arr.length){
        wrap.innerHTML = `<div class="small">Belum ada data keunggulan.</div>`;
        return;
      }

      arr.forEach(x=>{
        const el = document.createElement("div");
        el.className = "card";
        el.innerHTML = `
          <h3 class="advTitle">${safeText(x.title || "")}</h3>
          <p class="advText">${safeText(x.text || "")}</p>
        `;
        wrap.appendChild(el);
      });
    }

    // ===== Testimonials Text slider (manual)
    let tIndex = 0;

    function renderTestimonialsText(d){
      const arr = Array.isArray(d.testimonialsText) ? d.testimonialsText : [];
      const track = $("tTrack");
      track.innerHTML = "";

      if(!arr.length){
        track.innerHTML = `<div class="small">Belum ada testimoni teks.</div>`;
        return;
      }

      arr.forEach(x=>{
        const el = document.createElement("div");
        el.className = "tCard";
        el.innerHTML = `
          <div class="tName">${safeText(x.name || "Anon")}</div>
          <p class="tText">${safeText(x.text || "")}</p>
        `;
        track.appendChild(el);
      });

      tIndex = 0;
      updateT();
    }

    function updateT(){
      const track = $("tTrack");
      const cards = track.children;
      if(!cards.length) return;

      const first = cards[0];
      const w = first.getBoundingClientRect().width + 14; // gap
      const x = Math.max(0, tIndex) * w;
      track.style.transform = `translateX(${-x}px)`;
    }

    $("tPrev").addEventListener("click", ()=>{
      tIndex = Math.max(0, tIndex - 1);
      updateT();
    });
    $("tNext").addEventListener("click", ()=>{
      const track = $("tTrack");
      const count = track.children.length || 0;
      tIndex = Math.min(Math.max(0, count - 1), tIndex + 1);
      updateT();
    });
    window.addEventListener("resize", ()=> setTimeout(updateT, 60));

    // ===== Testimonials Images (gallery)
    let gIndex = 0;
    let gArr = [];

    function renderTestimonialsImages(d){
      gArr = Array.isArray(d.testimonialsImages) ? d.testimonialsImages : [];
      gIndex = 0;

      const row = $("thumbRow");
      row.innerHTML = "";

      if(!gArr.length){
        $("gMainImg").src = "";
        $("gCap").textContent = "Belum ada testimoni gambar.";
        return;
      }

      gArr.forEach((x, i)=>{
        const t = document.createElement("div");
        t.className = "thumb";
        t.innerHTML = `<img src="${safeText(x.src || "")}" alt="" loading="lazy" />`;
        t.addEventListener("click", ()=>{ setGallery(i); });
        row.appendChild(t);
      });

      setGallery(0);
    }

    function setGallery(i){
      if(!gArr.length) return;
      gIndex = Math.max(0, Math.min(gArr.length-1, i));
      const cur = gArr[gIndex];
      $("gMainImg").src = cur.src || "";
      $("gCap").textContent = cur.cap ? cur.cap : "";
    }

    $("gMain").addEventListener("click", ()=>{
      if(!gArr.length) return;
      openImgPopup(gIndex);
    });

    function openImgPopup(i){
      if(!gArr.length) return;
      gIndex = i;
      const cur = gArr[gIndex];
      $("imgBig").src = cur.src || "";
      $("imgCaption").textContent = cur.cap ? cur.cap : "";
      $("imgOverlay").style.display = "flex";
    }

    function stepImg(dir){
      if(!gArr.length) return;
      gIndex = (gIndex + dir + gArr.length) % gArr.length;
      const cur = gArr[gIndex];
      $("imgBig").src = cur.src || "";
      $("imgCaption").textContent = cur.cap ? cur.cap : "";
      setGallery(gIndex);
    }

    $("imgPrev").addEventListener("click", ()=> stepImg(-1));
    $("imgNext").addEventListener("click", ()=> stepImg(1));
    $("imgClose").addEventListener("click", ()=> $("imgOverlay").style.display="none");
    $("imgOverlay").addEventListener("click", (e)=>{ if(e.target.id==="imgOverlay") $("imgOverlay").style.display="none"; });

    // ===== Forms (main + tips) using Formspree endpoint from data.json
    function setupForm(d, formId, msgId, selectId, noteId){
      const form = $(formId);
      const msg  = $(msgId);
      const sel  = $(selectId);
      const note = $(noteId);
      if(!form || !sel) return;

      // placeholder note dari settings
      if(note) note.placeholder = d?.settings?.form?.notePlaceholder || note.placeholder || "Catatan (opsional)";

      // isi dropdown layanan dari services
      sel.innerHTML = "";
      const opt0 = document.createElement("option");
      opt0.value = "";
      opt0.textContent = "Pilih layanan";
      sel.appendChild(opt0);

      (d.services||[]).forEach(s=>{
        const opt = document.createElement("option");
        opt.value = s.title || s.id || "";
        opt.textContent = s.title || s.id || "";
        sel.appendChild(opt);
      });

      form.addEventListener("submit", async (e)=>{
        e.preventDefault();
        if(msg) msg.textContent = "";

        const endpoint = d?.settings?.form?.formspreeEndpoint || "";
        if(!endpoint){
          if(msg) msg.textContent = "Form belum aktif (endpoint kosong).";
          toast("Form belum aktif. Endpoint Formspree masih kosong.", "bad");
          return;
        }

        const fd = new FormData(form);

        try{
          const res = await fetch(endpoint, {
            method:"POST",
            headers:{ "Accept":"application/json" },
            body: fd
          });

          if(res.ok){
            toast("Terkirim. Kami hubungi via WhatsApp.", "ok");
            form.reset();
            if(msg) msg.textContent = "Terkirim. Kami hubungi via WhatsApp.";
          }else{
            toast("Gagal mengirim. Coba lagi.", "bad");
            if(msg) msg.textContent = "Gagal mengirim. Coba lagi.";
          }
        }catch(err){
          toast("Gagal mengirim. Cek koneksi.", "bad");
          if(msg) msg.textContent = "Gagal mengirim. Cek koneksi.";
        }
      });
    }

    // ===== Tips mode router
    function showTipsMode(on){
      $("mainSite").hidden = on;
      $("tipsView").hidden = !on;
      window.scrollTo({top:0, behavior:"instant"});
    }

    function renderTipsList(d){
      const list = $("tipsList");
      const art  = $("tipsArticle");
      list.hidden = false;
      art.hidden = true;

      const arr = Array.isArray(d?.tips) ? d.tips : [];
      list.innerHTML = "";

      if(!arr.length){
        list.innerHTML = `<div class="small">Belum ada tips.</div>`;
        return;
      }

      arr.forEach(t=>{
        const el = document.createElement("div");
        el.className = "tipsCard";
        const preview = (t.preview || t.content || "").toString().trim().split(/\s+/).slice(0, 28).join(" ");
        el.innerHTML = `
          <div class="tipsCardTitle">${safeText(t.title || "")}</div>
          <p class="tipsCardPrev">${safeText(preview)}${preview ? "..." : ""}</p>
        `;
        el.addEventListener("click", ()=>{
          location.hash = "#tips/" + encodeURIComponent(t.id || t.title || "");
        });
        list.appendChild(el);
      });
    }

    function renderTipsArticle(d, id){
      const list = $("tipsList");
      const art  = $("tipsArticle");
      list.hidden = true;
      art.hidden = false;

      const arr = Array.isArray(d?.tips) ? d.tips : [];
      const item = arr.find(x => (x.id || x.title) === id) || arr.find(x => (x.id || x.title) == id);

      if(!item){
        art.innerHTML = `<h1>Tips tidak ditemukan</h1><p>Silakan kembali ke daftar tips.</p>`;
        return;
      }

      // cover optional: item.cover
      const cover = item.cover ? `<img class="tipsCover" src="${safeText(item.cover)}" alt="" />` : "";

      // content can be simple text. We render paragraphs by split blank lines.
      const raw = (item.content || "").toString().trim();
      const blocks = raw
        .split(/\n\s*\n/g)
        .map(p=>p.trim())
        .filter(Boolean)
        .map(p=>{
          // bullet lines start with • or -
          if(p.split("\n").some(l=>/^\s*[•\-]\s+/.test(l))){
            const lis = p.split("\n")
              .map(l=>l.trim())
              .filter(l=>/^\s*[•\-]\s+/.test(l))
              .map(l=>`<li>${safeText(l.replace(/^\s*[•\-]\s+/,""))}</li>`)
              .join("");
            return `<ul>${lis}</ul>`;
          }
          return `<p>${safeText(p).replace(/\n/g,"<br/>")}</p>`;
        }).join("");

      // related box (cek juga tips ini) with 5 links
      const others = arr.filter(x => (x.id || x.title) !== (item.id || item.title)).slice(0, 8);
      const rel = `
        <div class="relatedBox">
          <div class="relatedBoxTitle">Cek juga tips ini</div>
          <ul>
            ${others.slice(0,5).map(x=>`<li><a href="#tips/${encodeURIComponent(x.id || x.title)}">${safeText(x.title || "")}</a></li>`).join("")}
          </ul>
        </div>
      `;

      art.innerHTML = `
        <h1>${safeText(item.title || "")}</h1>
        <div class="meta">${safeText(item.meta || "")}</div>
        ${cover}
        ${blocks}
        ${rel}
      `;
    }

    function handleHash(d){
      const h = (location.hash || "#home").replace("#","").trim();

      if(h === "tips"){
        showTipsMode(true);
        renderTipsList(d);
        return;
      }
      if(h.startsWith("tips/")){
        showTipsMode(true);
        const id = decodeURIComponent(h.slice(5));
        renderTipsArticle(d, id);
        return;
      }

      showTipsMode(false);
    }

    // Tips buttons
    $("tipsBackBtn").addEventListener("click", ()=>{ location.hash = "#home"; });
    $("tipsCtaBtn").addEventListener("click", ()=>{
      // ke form di bawah tips
      const el = $("tipsFooter");
      if(el) el.scrollIntoView({behavior:"smooth", block:"start"});
    });

    // ===== Admin (owner-only, localStorage)
    const LS_ADMIN_PASS = "jokitoefl_admin_pass_v1";
    $("adminFab").addEventListener("click", ()=>{
      const saved = localStorage.getItem(LS_ADMIN_PASS) || "";
      const pwd = prompt(saved ? "Masukkan password admin:" : "Buat password admin (sekali saja, tersimpan di browser kamu):");
      if(!pwd) return;
      if(saved && pwd !== saved){
        toast("Password salah.", "bad");
        return;
      }
      if(!saved){
        localStorage.setItem(LS_ADMIN_PASS, pwd);
        toast("Password admin tersimpan di browser kamu.", "ok");
      }else{
        toast("Admin aktif (mode owner).", "ok");
      }
      alert("Admin panel belum kamu minta di versi ini (biar aman). Kalau kamu mau editor lengkap: settings/layanan/keunggulan/tips/testimoni → aku tambah setelah ini.");
    });

    // ===== BOOT
    (async ()=>{
      const DATA = await fetchRemote();
      if(!DATA){
        console.warn("Gagal load data.json");
        toast("Gagal load data.json. Cek file repo.", "bad");
        return;
      }

      // global
      window.__DATA__ = DATA;

      applySettings(DATA);
      applyLogo(DATA);
      renderAbout(DATA);
      renderServices(DATA);
      renderAdvantages(DATA);
      renderTestimonialsText(DATA);
      renderTestimonialsImages(DATA);

      setupForm(DATA, "contactForm", "formMsg", "serviceSelect", "noteField");
      setupForm(DATA, "tipsForm", "tipsFormMsg", "tipsServiceSelect", "tipsNote");

      // footer year
      $("year").textContent = new Date().getFullYear();

      // run router
      handleHash(DATA);

      // hash change
      window.addEventListener("hashchange", ()=> handleHash(window.__DATA__));
    })();
  </script>
</body>
</html>
