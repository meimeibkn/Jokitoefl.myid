<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jokitoefl.myid</title>

  <style>
    :root{
      --navy:#002D5F;
      --sky:#A1C0F8;
      --black:#000000;
      --white:#FFFFFF;

      --bg: var(--navy);
      --bg2: #062a57;

      --card: rgba(255,255,255,.06);
      --card2: rgba(255,255,255,.04);
      --line: rgba(255,255,255,.16);

      --text: rgba(255,255,255,.94);
      --muted: rgba(255,255,255,.72);

      --r: 18px;
      --shadow: 0 18px 60px rgba(0,0,0,.25);

      --max: 1100px;
      --pad: 18px;
    }

    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      background:
        radial-gradient(950px 520px at 10% 0%, rgba(161,192,248,.22), transparent 60%),
        radial-gradient(920px 580px at 90% 10%, rgba(255,255,255,.08), transparent 60%),
        linear-gradient(180deg, var(--bg), var(--bg2));
      color:var(--text);
    }
    a{color:inherit;text-decoration:none}

    .wrap{max-width:var(--max);margin:auto;padding:var(--pad)}
    @media (max-width:480px){ .wrap{padding:16px} }

    header{
      border-bottom:1px solid var(--line);
      background: rgba(0,45,95,.65);
      backdrop-filter: blur(8px);
    }
    .nav{
      display:flex;align-items:center;justify-content:space-between;gap:14px;
      flex-wrap:wrap;
    }
    .brand{display:flex;align-items:center;gap:12px;min-width:0}
    .logo{
      width:38px;height:38px;border-radius:14px;
      background: linear-gradient(135deg, rgba(161,192,248,.95), rgba(161,192,248,.35));
      border:1px solid rgba(161,192,248,.35);
      box-shadow: 0 16px 50px rgba(161,192,248,.18);
      flex: 0 0 auto;
    }
    .brandText{min-width:0}
    .brandName{font-weight:900;letter-spacing:-.2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .brandSub{font-size:12px;color:var(--muted);margin-top:2px}

    .navLinks{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .link{
      padding:10px 12px;border-radius:12px;border:1px solid transparent;
      color:var(--muted);font-size:14px;
    }
    .link:hover{border-color:rgba(161,192,248,.22);color:var(--text);background:rgba(255,255,255,.04)}

    .btn{
      padding:10px 14px;border-radius:12px;border:1px solid var(--line);
      background:rgba(255,255,255,.06);color:var(--text);cursor:pointer;
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      font-weight:800;
    }
    .btn:hover{background:rgba(255,255,255,.10)}
    .btn.primary{
      border:none;
      background: linear-gradient(135deg, rgba(161,192,248,.95), rgba(161,192,248,.55));
      color:#061022;
      font-weight:900;
    }

    section{scroll-margin-top:16px}
    .panel{
      border:1px solid var(--line);
      background: linear-gradient(180deg, var(--card), var(--card2));
      border-radius:var(--r);
      box-shadow: var(--shadow);
      padding:18px;
    }
    h1,h2,h3{margin:0 0 10px}
    p{margin:0}
    .small{font-size:12px;color:var(--muted);line-height:1.6}
    .muted{color:var(--muted)}

    /* HERO */
    .hero{padding:18px 0 8px;display:flex}
    .heroInner{width:100%;max-width:780px}
    .title{font-size:44px;line-height:1.05;letter-spacing:-.8px;margin:14px 0 0}
    .accent{color:var(--sky)}
    .badge{
      display:inline-flex;align-items:center;gap:8px;
      padding:7px 12px;border-radius:999px;
      border:1px solid rgba(161,192,248,.28);
      background: rgba(161,192,248,.10);
      color: rgba(255,255,255,.85);
      font-size:12px;margin:10px 0 0;
    }
    .subhead{margin-top:12px;color:var(--muted);line-height:1.7}
    .heroActions{display:flex;gap:10px;flex-wrap:wrap;margin-top:16px}
    @media (max-width:720px){ .title{font-size:36px} .heroInner{max-width:100%} }

    /* SERVICES */
    .grid2{display:grid;grid-template-columns:repeat(12,1fr);gap:14px;margin-top:12px}
    .svc{
      grid-column:span 6;
      border:1px solid var(--line);
      background: rgba(255,255,255,.05);
      border-radius: var(--r);
      padding:16px;
      box-shadow: var(--shadow);
      cursor:pointer;
      transition: transform .12s ease, background .12s ease;
    }
    .svc:hover{transform: translateY(-1px); background: rgba(255,255,255,.07)}
    .svcTitle{font-weight:900;margin:0 0 6px}
    .svcDesc{color:var(--muted);line-height:1.6}
    @media (max-width:860px){ .svc{grid-column:span 12} }

    /* ADVANTAGES */
    .advGrid{
      display:grid;
      grid-template-columns:repeat(2, minmax(0,1fr));
      gap:14px;margin-top:12px;
    }
    .adv{
      border:1px solid var(--line);
      background: rgba(255,255,255,.05);
      border-radius: var(--r);
      padding:16px;
      box-shadow: var(--shadow);
    }
    .adv h3{margin:0 0 8px;font-size:16px}
    .adv p{color:var(--muted);line-height:1.6}
    .adv.last{
      grid-column: 1 / -1;
      display:flex;justify-content:center;
    }
    .adv.last > .advInner{
      width: 100%;
      max-width: calc((var(--max) - 2*var(--pad) - 14px) / 2);
    }
    @media (max-width:860px){
      .advGrid{grid-template-columns:1fr}
      .adv.last > .advInner{max-width:100%}
    }

    /* TESTIMONIALS TEXT */
    .tWrap{margin-top:12px}
    .tViewport{
      overflow:hidden;
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      border-radius: var(--r);
      box-shadow: var(--shadow);
    }
    .tTrack{
      display:flex;
      gap:14px;
      padding:14px;
      transform: translateX(0);
      transition: transform .28s ease;
      will-change: transform;
    }
    .tCard{
      flex: 0 0 calc((100% - 2*14px) / 2.5);
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.10);
      border-radius: 16px;
      padding:14px;
      min-height: 110px;
    }
    .tQuote{margin:0;color:var(--text);line-height:1.7;font-size:14px}
    .tWho{margin-top:10px;color:var(--muted);font-size:12px;display:flex;align-items:center;gap:8px}
    .dot{width:8px;height:8px;border-radius:999px;background:rgba(161,192,248,.8);border:1px solid rgba(161,192,248,.55)}
    .tControls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
    .iconBtn{
      width:40px;height:40px;border-radius:14px;border:1px solid var(--line);
      background:rgba(255,255,255,.06);cursor:pointer;color:var(--text);font-weight:900;
    }
    .iconBtn:hover{background:rgba(255,255,255,.10)}
    @media (max-width:860px){
      .tCard{flex-basis: 90%;}
      .tTrack{gap:12px}
    }

    /* TESTIMONIALS IMAGES */
    .gLayout{display:grid;grid-template-columns: 1.2fr .8fr; gap:14px; margin-top:12px}
    .bigBox{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      border-radius: var(--r);
      overflow:hidden;
      box-shadow: var(--shadow);
      cursor:pointer;
    }
    .bigImg{width:100%;height:420px;object-fit:cover;display:block}
    .thumbCol{
      border:1px solid var(--line);
      background: rgba(255,255,255,.04);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding:12px;
      overflow:hidden;
    }
    .thumbRow{
      display:flex;
      gap:10px;
      overflow:auto;
      padding-bottom:6px;
      scroll-snap-type: x mandatory;
    }
    .thumb{
      flex:0 0 110px;
      height:110px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.16);
      overflow:hidden;
      background: rgba(0,0,0,.12);
      cursor:pointer;
      scroll-snap-align:start;
      position:relative;
    }
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .thumb.active{outline:2px solid rgba(161,192,248,.85); outline-offset:2px}
    @media (max-width:980px){
      .gLayout{grid-template-columns:1fr}
      .bigImg{height:360px}
    }

    /* MODALS */
    .overlay{
      position:fixed;inset:0;background:rgba(0,0,0,.45);
      display:none;align-items:center;justify-content:center;
      padding:16px;z-index:50;
    }
    .modal{
      width:min(900px, 100%);
      max-height:85vh;
      overflow:auto;
      background: linear-gradient(180deg, rgba(0,45,95,.98), rgba(0,45,95,.92));
      border:1px solid rgba(255,255,255,.18);
      border-radius: 18px;
      box-shadow: 0 28px 90px rgba(0,0,0,.45);
      padding:16px;
    }
    .modalHead{display:flex;justify-content:space-between;gap:12px;align-items:flex-start}
    .modalTitle{font-size:18px;font-weight:900;margin:0}
    .closeBtn{
      width:40px;height:40px;border-radius:14px;border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.06);cursor:pointer;color:var(--text);font-weight:900;
    }
    .closeBtn:hover{background:rgba(255,255,255,.10)}
    .modalSection{margin-top:12px;border-top:1px solid rgba(255,255,255,.14);padding-top:12px}
    .modalSection h4{margin:0 0 8px;font-size:14px;color:rgba(161,192,248,.95)}
    ul{margin:0;padding-left:18px;color:var(--muted);line-height:1.7}
    li{margin:4px 0}

    .gPopupGrid{display:grid;grid-template-columns:1.2fr .8fr;gap:12px;margin-top:12px}
    .gPopupImg{
      width:100%;max-height:540px;object-fit:contain;
      background:rgba(0,0,0,.15);
      border-radius:14px;border:1px solid rgba(255,255,255,.14)
    }
    .gPopupSide{border:1px solid rgba(255,255,255,.14);border-radius:14px;padding:12px;background:rgba(255,255,255,.04)}
    .gPopupControls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px}
    .capBox{margin-top:10px;color:var(--muted);font-size:13px;line-height:1.6}
    @media (max-width:980px){ .gPopupGrid{grid-template-columns:1fr} }

    /* FORM */
    .formGrid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px;margin-top:12px}
    .col6{grid-column:span 6}
    .col12{grid-column:1/-1}
    label{display:block;margin:0 0 6px;font-size:12px;color:var(--muted)}
    input,select,textarea{
      width:100%;
      padding:11px 12px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.10);
      color: var(--text);
      outline:none;
    }
    input:focus,select:focus,textarea:focus{
      border-color: rgba(161,192,248,.7);
      box-shadow: 0 0 0 4px rgba(161,192,248,.16);
    }
    @media (max-width:860px){ .col6{grid-column:1/-1} }

    /* Floating admin */
    .fab{
      position:fixed;right:16px;bottom:16px;z-index:60;
      width:52px;height:52px;border-radius:999px;
      border:1px solid rgba(161,192,248,.35);
      background: rgba(161,192,248,.12);
      color: rgba(255,255,255,.92);
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;
      box-shadow: 0 18px 60px rgba(0,0,0,.25);
      user-select:none;
    }
    .fab:hover{background:rgba(161,192,248,.16)}
    .fab svg{width:22px;height:22px}

    .toast{
      position:fixed;left:16px;bottom:16px;z-index:70;
      max-width:360px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.28);
      backdrop-filter: blur(10px);
      color:var(--text);
      border-radius:14px;
      padding:12px 14px;
      display:none;
      box-shadow: var(--shadow);
    }
  </style>
</head>

<body>
<header>
  <div class="wrap nav">
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div class="brandText">
        <div class="brandName" id="siteName">Jokitoefl.myid</div>
        <div class="brandSub" id="brandSub">Sertifikat • Bantuan Mahasiswa • Lainnya</div>
      </div>
    </div>

    <nav class="navLinks" aria-label="menu">
      <a class="link" href="#home">Home</a>
      <a class="link" href="#about">About</a>
      <a class="link" href="#layanan">Layanan</a>
      <a class="link" href="#keunggulan">Keunggulan</a>
      <a class="link" href="#testimoni">Testimoni</a>
      <a class="btn primary" href="#daftar" id="ctaTop">Konsultasi Gratis</a>
    </nav>
  </div>
</header>

<main class="wrap">
  <!-- HERO -->
  <section id="home" class="hero">
    <div class="heroInner">
      <h1 class="title" id="headline">One stop for your <span class="accent">future</span></h1>
      <div class="badge" id="heroBadge">Sertifikat TOEFL & Komputer • Bantuan Mahasiswa • Lainnya</div>
      <p class="subhead" id="subhead"></p>

      <div class="heroActions">
        <a class="btn primary" href="#daftar" id="ctaHero">Konsultasi Gratis</a>
        <a class="btn" href="#layanan">Lihat Layanan</a>
        <a class="btn" id="igBtn" target="_blank" rel="noreferrer">Instagram</a>
      </div>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="panel" style="margin-top:14px">
    <h2>About Us</h2>
    <p id="aboutText" class="muted" style="line-height:1.75"></p>
  </section>

  <!-- SERVICES -->
  <section id="layanan" class="panel" style="margin-top:14px">
    <h2>Layanan</h2>
    <p class="small">Klik card untuk lihat info lengkap. Kamu bisa lanjut konsultasi langsung dari modal.</p>
    <div class="grid2" id="servicesWrap"></div>
  </section>

  <!-- ADVANTAGES -->
  <section id="keunggulan" class="panel" style="margin-top:14px">
    <h2>Keunggulan</h2>
    <div class="advGrid" id="advWrap"></div>
  </section>

  <!-- TESTIMONIALS -->
  <section id="testimoni" class="panel" style="margin-top:14px">
    <h2>Testimoni</h2>

    <h3 style="margin-top:10px">Teks</h3>
    <div class="tWrap">
      <div class="tViewport" id="tViewport">
        <div class="tTrack" id="tTrack"></div>
      </div>
      <div class="tControls">
        <button class="iconBtn" id="tPrev" type="button" aria-label="prev">‹</button>
        <button class="iconBtn" id="tNext" type="button" aria-label="next">›</button>
        <span class="small">Geser atau klik tombol. Manual, tanpa blur.</span>
      </div>
    </div>

    <h3 style="margin-top:16px">Gambar</h3>
    <p class="small">Klik gambar besar untuk lihat detail di popup (caption hanya di popup).</p>

    <div class="gLayout" id="galleryWrap">
      <div class="bigBox" id="bigBox" role="button" aria-label="open image popup">
        <img class="bigImg" id="bigImg" alt="testimoni" />
      </div>
      <div class="thumbCol">
        <div class="small">Thumbnails (4–6 terlihat, geser samping untuk sisanya)</div>
        <div class="thumbRow" id="thumbRow" style="margin-top:10px"></div>
      </div>
    </div>
    <div id="galleryEmpty" class="small" style="margin-top:10px;display:none">Belum ada testimoni gambar.</div>
  </section>

  <!-- FORM -->
  <section id="daftar" class="panel" style="margin-top:14px">
    <h2 id="formTitle">Form Konsultasi</h2>
    <p class="small" id="formSubtitle"></p>

    <form id="leadForm">
      <!-- honeypot -->
      <div style="position:absolute;left:-9999px;top:-9999px;opacity:0">
        <label>Company</label>
        <input name="company" autocomplete="off" />
      </div>

      <div class="formGrid">
        <div class="col6">
          <label>Nama</label>
          <input name="nama" id="fNama" required placeholder="Nama kamu" />
        </div>
        <div class="col6">
          <label>No WhatsApp</label>
          <input name="wa" id="fWa" required placeholder="08xxxx / 628xxxx" />
        </div>
        <div class="col12">
          <label>Layanan</label>
          <select name="layanan" id="fLayanan" required></select>
        </div>
        <div class="col12">
          <label>Catatan (opsional)</label>
          <textarea name="catatan" id="fCatatan" rows="3" placeholder="Contoh: tanya harga, durasi kelas, deadline, dll"></textarea>
        </div>
        <div class="col12" style="display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:4px">
          <button class="btn primary" type="submit">Kirim</button>
          <span class="small" id="formHint"></span>
        </div>
      </div>
    </form>
  </section>

  <div class="small" style="margin:18px 0 28px;color:rgba(255,255,255,.55)">
    © <span id="year"></span> <span id="footerName">Jokitoefl.myid</span>
  </div>
</main>

<!-- Service Modal -->
<div class="overlay" id="svcOverlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="service detail">
    <div class="modalHead">
      <div>
        <h3 class="modalTitle" id="svcModalTitle"></h3>
        <div class="small" id="svcModalDesc"></div>
      </div>
      <button class="closeBtn" id="svcClose" type="button">✕</button>
    </div>
    <div id="svcModalBody"></div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:14px">
      <a class="btn primary" href="#daftar" id="svcCta">Konsultasi Gratis</a>
      <button class="btn" id="svcScroll" type="button">Isi Form Sekarang</button>
    </div>
  </div>
</div>

<!-- Gallery Popup -->
<div class="overlay" id="gOverlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="image popup">
    <div class="modalHead">
      <div>
        <h3 class="modalTitle">Testimoni Gambar</h3>
        <div class="small">Gunakan tombol prev/next untuk pindah.</div>
      </div>
      <button class="closeBtn" id="gClose" type="button">✕</button>
    </div>

    <div class="gPopupGrid">
      <div>
        <img id="gPopupImg" class="gPopupImg" alt="popup testimoni" />
        <div class="gPopupControls">
          <button class="btn" id="gPrev" type="button">Prev</button>
          <button class="btn" id="gNext" type="button">Next</button>
        </div>
      </div>
      <div class="gPopupSide">
        <div class="small">Caption (hanya di popup)</div>
        <div class="capBox" id="gCaption"></div>
      </div>
    </div>
  </div>
</div>

<!-- Admin Floating Button -->
<button class="fab" id="adminFab" title="Admin" aria-label="admin">
  <svg viewBox="0 0 24 24" fill="none" aria-hidden="true">
    <path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7Z" stroke="currentColor" stroke-width="2"/>
    <path d="M19.4 15a7.9 7.9 0 0 0 .1-2l2-1.2-2-3.4-2.3.6a7.6 7.6 0 0 0-1.6-1l-.3-2.4H11l-.3 2.4a7.6 7.6 0 0 0-1.6 1l-2.3-.6-2 3.4 2 1.2a7.9 7.9 0 0 0 .1 2l-2 1.2 2 3.4 2.3-.6a7.6 7.6 0 0 0 1.6 1l.3 2.4h4.2l.3-2.4a7.6 7.6 0 0 0 1.6-1l2.3.6 2-3.4-2-1.2Z" stroke="currentColor" stroke-width="2" opacity=".9"/>
  </svg>
</button>

<!-- Admin Panel -->
<div class="overlay" id="aOverlay" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-label="admin panel">
    <div class="modalHead">
      <div>
        <h3 class="modalTitle">Admin</h3>
        <div class="small">Login lokal. Password tidak masuk repo. Publish global: Copy JSON → paste ke <b>data.json</b> di GitHub → commit.</div>
      </div>
      <button class="closeBtn" id="aClose" type="button">✕</button>
    </div>

    <div id="aLoginBox" class="panel" style="margin-top:12px">
      <h3 style="margin:0 0 8px">Login / Set Admin</h3>
      <div class="small">Pertama kali: set username & password. Berikutnya: login pakai yang sama.</div>

      <div class="formGrid">
        <div class="col6">
          <label>Username</label>
          <input id="aUser" autocomplete="username" />
        </div>
        <div class="col6">
          <label>Password</label>
          <input id="aPass" type="password" autocomplete="current-password" />
        </div>
        <div class="col12" style="display:flex;gap:10px;flex-wrap:wrap">
          <button class="btn primary" id="aLoginBtn" type="button">Masuk / Set</button>
          <button class="btn" id="aResetBtn" type="button">Reset Login Lokal</button>
        </div>
      </div>
    </div>

    <div id="aDash" style="display:none;margin-top:12px">
      <div class="panel">
        <h3 style="margin:0 0 8px">Publish Global</h3>
        <div class="small">Setelah kamu commit `data.json`, publik akan ikut berubah. Cek dengan Incognito atau Ctrl+Shift+R.</div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px">
          <button class="btn primary" id="aCopyBtn" type="button">Copy JSON untuk data.json</button>
          <a class="btn" id="aOpenGit" target="_blank" rel="noreferrer">Buka GitHub edit data.json</a>
        </div>
      </div>

      <div class="panel" style="margin-top:14px">
        <h3 style="margin:0 0 8px">Ganti Password Admin</h3>
        <div class="small">Wajib masukkan password lama dulu.</div>
        <div class="formGrid">
          <div class="col6">
            <label>Password lama</label>
            <input id="oldPass" type="password" />
          </div>
          <div class="col6">
            <label>Password baru</label>
            <input id="newPass" type="password" />
          </div>
          <div class="col6">
            <label>Ulangi password baru</label>
            <input id="newPass2" type="password" />
          </div>
          <div class="col12">
            <button class="btn primary" id="changePassBtn" type="button">Simpan Password Baru</button>
          </div>
        </div>
      </div>

      <div class="panel" style="margin-top:14px">
        <h3 style="margin:0 0 8px">Catatan</h3>
        <div class="small">
          Versi ini fokus aman + visual final. Setelah ini, kalau kamu mau admin bisa edit semua konten langsung dari panel,
          kita tambahkan form editor lengkap (settings, layanan, keunggulan, testimoni teks & gambar) tanpa bocorin data pribadi.
        </div>
      </div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
  // Konfigurasi repo (untuk tombol "Buka GitHub edit data.json")
  const GITHUB_USER = "meimeibkn";
  const GITHUB_REPO = "Jokitoefl.myid";

  const KEY_ADMIN = "JTK_ADMIN_V1";
  const KEY_AUTH  = "JTK_AUTH_V1";

  const $ = (id) => document.getElementById(id);

  function toast(msg){
    const t = $("toast");
    t.textContent = msg;
    t.style.display = "block";
    clearTimeout(window.__t);
    window.__t = setTimeout(()=>t.style.display="none", 2600);
  }

  function safeText(s){ return String(s ?? ""); }

  // --- Load data.json (with cache-buster) ---
  let DATA = null;

  async function fetchRemote(){
    try{
      const res = await fetch("./data.json?v=" + Date.now(), { cache:"no-store" });
      if(!res.ok) return null;
      const obj = await res.json();
      if(!obj || !obj.settings || !obj.services) return null;
      return obj;
    }catch(e){ return null; }
  }

  // --- Render ---
  function renderTop(d){
    $("siteName").textContent = safeText(d.settings.siteName);
    $("footerName").textContent = safeText(d.settings.siteName);
    $("year").textContent = new Date().getFullYear();

    // highlight "future"
    const raw = safeText(d.settings.headline);
    $("headline").innerHTML = raw.replace(/future/gi, "<span class='accent'>future</span>");

    $("heroBadge").textContent = safeText(d.settings.badge);
    $("brandSub").textContent = safeText(d.settings.badge);

    $("subhead").textContent = safeText(d.settings.subhead);
    $("aboutText").textContent = safeText(d.settings.about);

    $("ctaTop").textContent  = safeText(d.settings.ctaText || "Konsultasi Gratis");
    $("ctaHero").textContent = safeText(d.settings.ctaText || "Konsultasi Gratis");

    $("formTitle").textContent = safeText(d.settings.formTitle || "Form Konsultasi");
    $("formSubtitle").textContent = safeText(d.settings.formSubtitle || "");

    $("igBtn").href = safeText(d.settings.instagram || "#");
  }

  function renderServices(d){
    const wrap = $("servicesWrap");
    wrap.innerHTML = "";

    (d.services || []).forEach((s)=>{
      const card = document.createElement("article");
      card.className = "svc";
      card.innerHTML = `
        <h3 class="svcTitle">${safeText(s.title)}</h3>
        <div class="svcDesc">${safeText(s.desc)}</div>
      `;
      card.onclick = ()=> openServiceModal(s);
      wrap.appendChild(card);
    });

    const sel = $("fLayanan");
    sel.innerHTML = `<option value="" disabled selected>Pilih layanan…</option>`;
    (d.services || []).forEach((s)=>{
      const opt = document.createElement("option");
      opt.value = s.title;
      opt.textContent = s.title;
      sel.appendChild(opt);
    });
  }

  function renderAdvantages(d){
    const advWrap = $("advWrap");
    advWrap.innerHTML = "";

    const arr = d.advantages || [];
    arr.forEach((a, idx)=>{
      if(idx === 4){
        const outer = document.createElement("div");
        outer.className = "adv last";
        outer.innerHTML = `
          <div class="advInner">
            <div class="adv">
              <h3>${safeText(a.title)}</h3>
              <p>${safeText(a.desc)}</p>
            </div>
          </div>
        `;
        advWrap.appendChild(outer);
        return;
      }
      const card = document.createElement("div");
      card.className = "adv";
      card.innerHTML = `<h3>${safeText(a.title)}</h3><p>${safeText(a.desc)}</p>`;
      advWrap.appendChild(card);
    });
  }

  // --- Service modal ---
  let currentServiceTitle = "";
  function openServiceModal(s){
    currentServiceTitle = s.title || "";
    $("svcModalTitle").textContent = safeText(s.title);
    $("svcModalDesc").textContent  = safeText(s.desc);

    const body = $("svcModalBody");
    body.innerHTML = "";

    (s.details || []).forEach(section=>{
      const div = document.createElement("div");
      div.className = "modalSection";
      const items = (section.items || []).map(x=>`<li>${safeText(x)}</li>`).join("");
      div.innerHTML = `<h4>${safeText(section.title)}</h4><ul>${items}</ul>`;
      body.appendChild(div);
    });

    $("svcOverlay").style.display = "flex";
  }
  function closeServiceModal(){ $("svcOverlay").style.display = "none"; }

  // --- Testimonials text slider (manual, no blur) ---
  let tIndex = 0;
  let dragging = false;
  let startX = 0;
  let lastX  = 0;

  function cardsPerView(){
    return window.matchMedia("(max-width: 860px)").matches ? 1 : 2.5;
  }

  function renderTestText(d){
    const track = $("tTrack");
    track.innerHTML = "";

    const arr = (d.testimonialsText || []).slice(0, 20);
    if(arr.length === 0){
      track.innerHTML = `<div class="tCard" style="flex-basis:90%"><p class="tQuote">Belum ada testimoni teks.</p><div class="tWho"><span class="dot"></span><span>Admin</span></div></div>`;
      tIndex = 0;
      applyTTransform();
      return;
    }

    arr.forEach(t=>{
      const card = document.createElement("div");
      card.className = "tCard";
      card.innerHTML = `
        <p class="tQuote">“${safeText(t.text)}”</p>
        <div class="tWho"><span class="dot"></span><span>${safeText(t.name || "Anonim")}</span></div>
      `;
      track.appendChild(card);
    });

    tIndex = 0;
    applyTTransform();
  }

  function applyTTransform(){
    const viewport = $("tViewport");
    const track = $("tTrack");
    const arr = (DATA.testimonialsText || []).slice(0, 20);
    const total = Math.max(arr.length, 1);

    const gap = window.matchMedia("(max-width: 860px)").matches ? 12 : 14;
    const vpW = viewport.clientWidth;

    const cpv = cardsPerView();
    const cardW = (vpW - gap * (cpv - 1)) / cpv;
    const step  = cardW + gap;

    const maxIndex = Math.max(0, total - Math.ceil(cpv));
    if(tIndex > maxIndex) tIndex = maxIndex;
    if(tIndex < 0) tIndex = 0;

    track.style.transform = `translateX(${-tIndex * step}px)`;
  }

  function tNext(){
    const total = (DATA.testimonialsText || []).slice(0, 20).length;
    const cpv = cardsPerView();
    const maxIndex = Math.max(0, total - Math.ceil(cpv));
    tIndex = Math.min(maxIndex, tIndex + 1);
    applyTTransform();
  }

  function tPrev(){
    tIndex = Math.max(0, tIndex - 1);
    applyTTransform();
  }

  function bindSwipe(){
    const viewport = $("tViewport");
    const track = $("tTrack");

    viewport.addEventListener("pointerdown",(e)=>{
      dragging = true;
      startX = e.clientX;
      lastX = e.clientX;
      track.style.transition = "none";
      viewport.setPointerCapture(e.pointerId);
    });

    viewport.addEventListener("pointermove",(e)=>{
      if(!dragging) return;
      const dx = e.clientX - lastX;
      lastX = e.clientX;

      const m = window.getComputedStyle(track).transform;
      let tx = 0;
      if(m && m !== "none"){
        const vals = m.match(/matrix\((.+)\)/);
        if(vals && vals[1]) tx = parseFloat(vals[1].split(",")[4]) || 0;
      }
      track.style.transform = `translateX(${tx + dx}px)`;
    });

    function end(e){
      if(!dragging) return;
      dragging = false;
      track.style.transition = "";
      const diff = e.clientX - startX;
      const threshold = 60;
      if(diff < -threshold) tNext();
      else if(diff > threshold) tPrev();
      else applyTTransform();
    }

    viewport.addEventListener("pointerup", end);
    viewport.addEventListener("pointercancel", end);
  }

  // --- Gallery (big + thumbs + popup) ---
  let gIndex = 0;

  function renderGallery(d){
    const imgs = (d.testimonialsImages || []).slice(0, 20);
    const bigImg = $("bigImg");
    const thumbRow = $("thumbRow");
    const empty = $("galleryEmpty");
    const wrap = $("galleryWrap");

    thumbRow.innerHTML = "";

    if(imgs.length === 0){
      wrap.style.display = "none";
      empty.style.display = "block";
      return;
    }

    wrap.style.display = "";
    empty.style.display = "none";

    gIndex = Math.max(0, Math.min(gIndex, imgs.length - 1));
    bigImg.src = imgs[gIndex].data;

    imgs.forEach((it, i)=>{
      const t = document.createElement("div");
      t.className = "thumb" + (i===gIndex ? " active" : "");
      t.innerHTML = `<img alt="thumb" src="${it.data}">`;
      t.onclick = ()=>{ gIndex = i; updateGallery(); };
      thumbRow.appendChild(t);
    });
  }

  function updateGallery(){
    const imgs = (DATA.testimonialsImages || []).slice(0, 20);
    if(imgs.length === 0) return;

    $("bigImg").src = imgs[gIndex].data;
    Array.from(document.querySelectorAll(".thumb"))
      .forEach((t,i)=>t.classList.toggle("active", i===gIndex));
  }

  function openGalleryPopup(){
    const imgs = (DATA.testimonialsImages || []).slice(0, 20);
    if(imgs.length === 0) return;

    $("gPopupImg").src = imgs[gIndex].data;
    $("gCaption").textContent = safeText(imgs[gIndex].cap || "");
    $("gOverlay").style.display = "flex";
  }
  function closeGalleryPopup(){ $("gOverlay").style.display = "none"; }

  function gNext(){
    const imgs = (DATA.testimonialsImages || []).slice(0, 20);
    if(imgs.length === 0) return;
    gIndex = (gIndex + 1) % imgs.length;
    $("gPopupImg").src = imgs[gIndex].data;
    $("gCaption").textContent = safeText(imgs[gIndex].cap || "");
    updateGallery();
  }
  function gPrev(){
    const imgs = (DATA.testimonialsImages || []).slice(0, 20);
    if(imgs.length === 0) return;
    gIndex = (gIndex - 1 + imgs.length) % imgs.length;
    $("gPopupImg").src = imgs[gIndex].data;
    $("gCaption").textContent = safeText(imgs[gIndex].cap || "");
    updateGallery();
  }

  // --- Formspree submit ---
  async function submitForm(e){
    e.preventDefault();
    const endpoint = DATA?.form?.endpoint || "";
    if(!endpoint || endpoint.includes("PASTE_FORMSPREE_ENDPOINT_HERE")){
      toast("Endpoint Formspree belum diisi di data.json.");
      return;
    }

    const honeypot = document.querySelector('input[name="company"]');
    if(honeypot && honeypot.value.trim()){
      toast("Terlihat seperti spam. Coba lagi.");
      return;
    }

    const payload = {
      nama: $("fNama").value.trim(),
      wa: $("fWa").value.trim(),
      layanan: $("fLayanan").value,
      catatan: $("fCatatan").value.trim(),
      _subject: "Konsultasi Jokitoefl.myid",
      source: location.href
    };

    try{
      const res = await fetch(endpoint, {
        method:"POST",
        headers: { "Content-Type":"application/json", "Accept":"application/json" },
        body: JSON.stringify(payload)
      });
      if(res.ok){
        toast(DATA?.form?.successMessage || "Terkirim. Terima kasih!");
        $("leadForm").reset();
      }else{
        toast("Gagal kirim. Coba lagi.");
      }
    }catch{
      toast("Gagal kirim. Cek koneksi.");
    }
  }

  // --- Admin local auth ---
  function getAdmin(){
    try{ return JSON.parse(localStorage.getItem(KEY_ADMIN) || "null"); }
    catch{ return null; }
  }
  function setAdmin(u,p){ localStorage.setItem(KEY_ADMIN, JSON.stringify({u,p})); }
  function isAuthed(){ return localStorage.getItem(KEY_AUTH) === "1"; }
  function setAuthed(v){ localStorage.setItem(KEY_AUTH, v ? "1" : "0"); }

  function openAdmin(){
    $("aOverlay").style.display = "flex";
    $("aOpenGit").href = `https://github.com/${GITHUB_USER}/${GITHUB_REPO}/edit/main/data.json`;
    const ok = isAuthed();
    $("aLoginBox").style.display = ok ? "none" : "";
    $("aDash").style.display = ok ? "" : "none";
  }
  function closeAdmin(){ $("aOverlay").style.display = "none"; }

  function adminLogin(){
    const u = $("aUser").value.trim();
    const p = $("aPass").value;
    if(!u || !p){ toast("Isi username & password."); return; }

    const saved = getAdmin();
    if(!saved){
      setAdmin(u,p);
      setAuthed(true);
      toast("Admin diset & login berhasil.");
      openAdmin();
      return;
    }
    if(u === saved.u && p === saved.p){
      setAuthed(true);
      toast("Login sukses.");
      openAdmin();
      return;
    }
    toast("Username/password salah.");
  }

  function resetLocalLogin(){
    if(!confirm("Reset login lokal? (Hanya di perangkat ini)")) return;
    localStorage.removeItem(KEY_ADMIN);
    localStorage.removeItem(KEY_AUTH);
    toast("Login lokal direset.");
  }

  function changePassword(){
    const saved = getAdmin();
    if(!saved){ toast("Admin belum diset."); return; }

    const oldP = $("oldPass").value;
    const newP = $("newPass").value;
    const newP2 = $("newPass2").value;

    if(!oldP || !newP || !newP2){ toast("Lengkapi semua field."); return; }
    if(oldP !== saved.p){ toast("Password lama salah."); return; }
    if(newP !== newP2){ toast("Konfirmasi password baru tidak sama."); return; }
    if(newP.length < 8){ toast("Password baru minimal 8 karakter."); return; }

    setAdmin(saved.u, newP);
    $("oldPass").value = ""; $("newPass").value = ""; $("newPass2").value = "";
    toast("Password berhasil diganti.");
  }

  // Copy JSON for data.json (public-safe)
  async function copyPublishJSON(){
    const pub = {
      version: DATA.version || 1,
      settings: DATA.settings,
      form: DATA.form,
      services: DATA.services,
      advantages: DATA.advantages,
      testimonialsText: DATA.testimonialsText,
      testimonialsImages: DATA.testimonialsImages
    };
    const txt = JSON.stringify(pub, null, 2);
    try{
      await navigator.clipboard.writeText(txt);
      toast("JSON tercopy. Paste ke data.json di GitHub lalu commit.");
    }catch{
      toast("Clipboard diblokir. Copy manual dari source / console.");
    }
  }

  // --- Init ---
  async function init(){
    DATA = await fetchRemote();
    if(!DATA){
      toast("Gagal load data.json. Cek file di repo.");
      DATA = {
        settings:{
          siteName:"Jokitoefl.myid",
          headline:"One stop for your future",
          badge:"Sertifikat TOEFL & Komputer • Bantuan Mahasiswa • Lainnya",
          subhead:"",
          instagram:"#",
          about:"",
          ctaText:"Konsultasi Gratis",
          formTitle:"Form Konsultasi",
          formSubtitle:""
        },
        form:{ provider:"formspree", endpoint:"", successMessage:"Terkirim.", antiSpam:{honeypotField:"company"} },
        services:[],
        advantages:[],
        testimonialsText:[],
        testimonialsImages:[]
      };
    }

    renderTop(DATA);
    renderServices(DATA);
    renderAdvantages(DATA);
    renderTestText(DATA);
    renderGallery(DATA);

    // service modal
    $("svcClose").onclick = closeServiceModal;
    $("svcOverlay").addEventListener("click",(e)=>{ if(e.target === $("svcOverlay")) closeServiceModal(); });
    $("svcScroll").onclick = ()=>{
      closeServiceModal();
      location.hash = "#daftar";
      if(currentServiceTitle) $("fLayanan").value = currentServiceTitle;
      $("fNama").focus();
    };
    $("svcCta").onclick = ()=>{
      if(currentServiceTitle) setTimeout(()=>{ $("fLayanan").value = currentServiceTitle; }, 0);
    };

    // testimonials text
    $("tPrev").onclick = tPrev;
    $("tNext").onclick = tNext;
    bindSwipe();
    window.addEventListener("resize", applyTTransform);

    // gallery
    $("bigBox").onclick = openGalleryPopup;
    $("gClose").onclick = closeGalleryPopup;
    $("gOverlay").addEventListener("click",(e)=>{ if(e.target === $("gOverlay")) closeGalleryPopup(); });
    $("gNext").onclick = gNext;
    $("gPrev").onclick = gPrev;

    // form
    $("leadForm").addEventListener("submit", submitForm);

    // admin
    $("adminFab").onclick = openAdmin;
    $("aClose").onclick = closeAdmin;
    $("aOverlay").addEventListener("click",(e)=>{ if(e.target === $("aOverlay")) closeAdmin(); });

    $("aLoginBtn").onclick = adminLogin;
    $("aResetBtn").onclick = resetLocalLogin;
    $("changePassBtn").onclick = changePassword;
    $("aCopyBtn").onclick = copyPublishJSON;
  }

  init();
</script>

</body>
</html>
