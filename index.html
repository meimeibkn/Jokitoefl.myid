<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Jokitoefl.myid</title>

  <style>
    :root{
      --navy:#002D5F;
      --sky:#A1C0F8;
      --black:#000;
      --white:#fff;

      --bg: radial-gradient(1200px 600px at 20% -10%, rgba(161,192,248,.18), transparent 60%),
            radial-gradient(900px 500px at 90% 10%, rgba(161,192,248,.10), transparent 55%),
            linear-gradient(180deg, #061a33, #020a14 75%);
      --card: rgba(255,255,255,.04);
      --stroke: rgba(161,192,248,.16);
      --muted: rgba(255,255,255,.75);
      --muted2: rgba(255,255,255,.62);
      --shadow: 0 16px 40px rgba(0,0,0,.30);
      --radius: 18px;
      --maxw: 1100px;
    }

    *{box-sizing:border-box}
    html,body{margin:0;padding:0}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
      background: var(--bg);
      color: var(--white);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      text-rendering: optimizeLegibility;
    }
    a{color:inherit;text-decoration:none}
    .wrap{max-width:var(--maxw); margin:0 auto; padding:0 18px}
    @media (max-width:520px){ .wrap{padding:0 16px} }

    /* NAV */
    .nav{
      position:sticky; top:0; z-index:20;
      backdrop-filter: blur(10px);
      background: rgba(2,10,20,.55);
      border-bottom: 1px solid rgba(161,192,248,.10);
    }
    .navRow{display:flex; align-items:center; justify-content:space-between; padding:12px 0}
    .brand{display:flex; align-items:center; gap:10px}
    .logoBox{
      width:36px; height:36px; border-radius:12px;
      background: linear-gradient(135deg, rgba(161,192,248,.90), rgba(161,192,248,.25));
      border:1px solid rgba(161,192,248,.20);
      display:grid; place-items:center;
      overflow:hidden;
    }
    #logoImg{width:100%; height:100%; object-fit:cover; display:none}
    .brandTxt{display:flex; flex-direction:column; line-height:1.1}
    .brandTxt strong{font-size:14px; letter-spacing:.2px}
    .brandTxt span{font-size:12px; color: rgba(255,255,255,.68)}
    .navLinks{display:flex; gap:14px; flex-wrap:wrap; justify-content:flex-end}
    .navLinks a{
      font-size:13px; color: rgba(255,255,255,.78);
      padding:8px 10px; border-radius:999px;
      border: 1px solid transparent;
    }
    .navLinks a:hover{border-color: rgba(161,192,248,.22); background: rgba(161,192,248,.06)}
    @media (max-width:760px){ .brandTxt span{display:none} }

    /* HERO */
    .hero{padding:18px 0 8px; display:flex}
    .heroInner{width:100%; max-width:780px}
    .title{font-size:44px; line-height:1.05; letter-spacing:-.8px; margin:14px 0 0}
    .accent{color:var(--sky)}
    .badge{
      display:inline-flex; align-items:center; gap:8px;
      padding:7px 12px; border-radius:999px;
      border:1px solid rgba(161,192,248,.22);
      background: rgba(161,192,248,.07);
      color: rgba(255,255,255,.78);
      font-size:11px;
      margin:18px 0 0;
    }
    .subhead{margin-top:12px; color: var(--muted); line-height:1.7}
    .heroActions{display:flex; gap:10px; flex-wrap:wrap; margin-top:16px}
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:11px 14px; border-radius:999px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(161,192,248,.16);
      color: rgba(255,255,255,.88);
      font-weight:700; font-size:13px;
      box-shadow: 0 10px 26px rgba(0,0,0,.18);
    }
    .btn:hover{border-color: rgba(161,192,248,.28); background: rgba(161,192,248,.06)}
    .btn.primary{
      background: rgba(161,192,248,.18);
      border-color: rgba(161,192,248,.34);
      color:#fff;
    }
    @media (max-width:720px){ .title{font-size:36px} .heroInner{max-width:100%} }

    /* SECTION */
    section{padding:28px 0}
    .secHead{display:flex; align-items:flex-end; justify-content:space-between; gap:16px; margin-bottom:14px}
    h2{margin:0; font-size:22px; letter-spacing:-.2px}
    .small{font-size:13px; color: rgba(255,255,255,.70); line-height:1.6}

    /* ABOUT */
    .aboutCard{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:16px;
      box-shadow: var(--shadow);
    }

    /* SERVICES */
    .svcGrid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:16px;
    }
    @media (max-width:860px){ .svcGrid{grid-template-columns:1fr} }
    .card{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      padding:16px;
      box-shadow: var(--shadow);
    }
    .svcCard{cursor:pointer; transition: transform .08s ease}
    .svcCard:hover{transform: translateY(-1px)}
    .cardTitle{font-weight:900; letter-spacing:.2px; margin:0 0 8px}
    .cardText{color: rgba(255,255,255,.78); line-height:1.65; margin:0}

    /* ADVANTAGES */
    .advGrid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:18px;
    }
    @media (max-width:820px){ .advGrid{grid-template-columns:1fr} }
    .advCard{
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(161,192,248,.16);
      border-radius: 16px;
      padding: 16px 16px 14px;
      box-shadow: 0 12px 30px rgba(0,0,0,.18);
    }
    .advTitle{margin:0 0 8px; font-size:16px; font-weight:900}
    .advText{margin:0; color: rgba(255,255,255,.82); line-height:1.65; font-size:14px}

    /* TESTIMONIALS TEXT slider */
    .tWrap{position:relative; overflow:hidden}
    .tTrack{display:flex; gap:14px; transition: transform .25s ease; will-change: transform}
    .tCard{
      min-width: 420px;
      max-width: 420px;
      background: rgba(255,255,255,.04);
      border:1px solid rgba(161,192,248,.14);
      border-radius: 16px;
      padding:14px;
      box-shadow: 0 10px 26px rgba(0,0,0,.16);
    }
    .tName{font-weight:900; margin:0 0 6px}
    .tText{margin:0; color: rgba(255,255,255,.82); line-height:1.6}
    @media (max-width:920px){
      .tCard{min-width: 78vw; max-width: 78vw}
    }
    .tCtrls{display:flex; gap:10px; margin-top:12px}
    .iconBtn{
      width:40px; height:40px; border-radius:999px;
      display:grid; place-items:center;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(161,192,248,.16);
      cursor:pointer;
    }
    .iconBtn:hover{background: rgba(161,192,248,.06); border-color: rgba(161,192,248,.26)}

    /* TESTIMONIALS IMAGES gallery */
    .gallery{
      display:grid;
      grid-template-columns: 1.4fr .6fr;
      gap:14px;
      align-items:start;
    }
    @media (max-width:900px){ .gallery{grid-template-columns:1fr} }
    .bigFrame{
      border-radius: 18px;
      overflow:hidden;
      border:1px solid rgba(161,192,248,.16);
      background: rgba(255,255,255,.03);
      box-shadow: var(--shadow);
      cursor:pointer;
    }
    .bigFrame img{width:100%; height:440px; object-fit:contain; background: rgba(0,0,0,.25)}
    @media (max-width:900px){ .bigFrame img{height:360px} }
    .thumbs{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }
    .thumb{
      border-radius: 14px;
      overflow:hidden;
      border:1px solid rgba(161,192,248,.12);
      background: rgba(255,255,255,.03);
      cursor:pointer;
      box-shadow: 0 10px 24px rgba(0,0,0,.14);
    }
    .thumb.active{border-color: rgba(161,192,248,.36)}
    .thumb img{width:100%; height:120px; object-fit:cover; display:block}
    .cap{margin-top:10px; color: rgba(255,255,255,.70); font-size:13px}

    /* CONTACT FORM */
    .formCard{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .formCard .full{grid-column:1/-1}
    @media (max-width:820px){ .formCard{grid-template-columns:1fr} }
    label{display:block; font-size:12px; color: rgba(255,255,255,.72); margin:0 0 6px}
    input, select, textarea{
      width:100%;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(161,192,248,.16);
      border-radius: 14px;
      padding:12px 12px;
      color: #fff;
      outline:none;
      font-size:14px;
    }
    textarea{min-height:110px; resize:vertical}
    input:focus, select:focus, textarea:focus{border-color: rgba(161,192,248,.36); background: rgba(161,192,248,.06)}
    .hint{margin-top:10px; font-size:13px; color: rgba(255,255,255,.70); line-height:1.6}

    /* MODAL */
    .overlay{
      position:fixed; inset:0; display:none; z-index:50;
      background: rgba(0,0,0,.55);
      padding:18px;
      align-items:center; justify-content:center;
    }
    .modal{
      width:min(900px, 96vw);
      max-height: 86vh;
      overflow:auto;
      background: rgba(7,20,38,.96);
      border:1px solid rgba(161,192,248,.20);
      border-radius: 18px;
      box-shadow: 0 30px 80px rgba(0,0,0,.55);
      padding:16px;
    }
    .modalTop{display:flex; align-items:flex-start; justify-content:space-between; gap:10px}
    .modalTop h3{margin:0; font-size:18px}
    .closeX{cursor:pointer; padding:8px 10px; border-radius:999px; border:1px solid rgba(161,192,248,.16); background: rgba(255,255,255,.05)}
    .closeX:hover{border-color: rgba(161,192,248,.28); background: rgba(161,192,248,.06)}
    .modalSection{margin-top:14px}
    .modalSection ul{margin:10px 0 0; padding-left:18px}
    .modalSection li{margin:8px 0; color: rgba(255,255,255,.82); line-height:1.6}
    .modalBadge{
      display:inline-flex;
      align-items:center;
      padding:6px 10px;
      border-radius:999px;
      margin:6px 0 10px;
      font-size:12px;
      font-weight:900;
      letter-spacing:.3px;
      text-transform:uppercase;
      border:1px solid rgba(161,192,248,.26);
      background: rgba(161,192,248,.10);
      color: rgba(255,255,255,.92);
    }
    .muted{color: rgba(255,255,255,.62)}
    .modalP{margin:10px 0 0; color: rgba(255,255,255,.75); line-height:1.65}

    /* GALLERY POPUP */
    .gImg{width:100%; height:60vh; object-fit:contain; background: rgba(0,0,0,.35); border-radius: 14px; border:1px solid rgba(161,192,248,.14)}
    .gActions{display:flex; gap:10px; margin-top:12px; justify-content:flex-end}
    .gActions .btn{padding:10px 12px}

    /* ADMIN floating button */
    .adminFab{
      position:fixed; right:14px; bottom:14px; z-index:60;
      width:44px; height:44px; border-radius:999px;
      display:grid; place-items:center;
      background: rgba(161,192,248,.18);
      border:1px solid rgba(161,192,248,.30);
      box-shadow: 0 18px 44px rgba(0,0,0,.35);
      cursor:pointer;
    }
    .adminFab:hover{background: rgba(161,192,248,.22)}
    .adminFab span{font-weight:900}

    /* ADMIN PANEL */
    .adminPanel{
      width:min(980px, 96vw);
      background: rgba(7,20,38,.96);
      border:1px solid rgba(161,192,248,.20);
      border-radius: 18px;
      box-shadow: 0 30px 80px rgba(0,0,0,.55);
      padding:16px;
    }
    .adminGrid{display:grid; grid-template-columns: 1fr 1fr; gap:12px}
    .adminGrid .full{grid-column:1/-1}
    @media (max-width:860px){ .adminGrid{grid-template-columns:1fr} }

    .kRow{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      padding:8px 10px; border-radius:999px;
      background: rgba(255,255,255,.05);
      border:1px solid rgba(161,192,248,.14);
      font-size:12px; color: rgba(255,255,255,.78);
    }
    .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}
    .toast{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:70px; z-index:80;
      background: rgba(7,20,38,.96);
      border:1px solid rgba(161,192,248,.22);
      padding:10px 12px;
      border-radius: 14px;
      color: rgba(255,255,255,.90);
      display:none;
      box-shadow: 0 18px 44px rgba(0,0,0,.35);
      max-width:min(760px, 92vw);
      font-size:13px;
    }
  </style>
</head>

<body>
  <!-- NAV -->
  <div class="nav">
    <div class="wrap">
      <div class="navRow">
        <div class="brand">
          <div class="logoBox" id="logoBox"><img id="logoImg" alt="" /></div>
          <div class="brandTxt">
            <strong id="siteName">Jokitoefl.myid</strong>
            <span id="tagline">One stop for your future</span>
          </div>
        </div>
        <div class="navLinks" id="navLinks"></div>
      </div>
    </div>
  </div>

  <main class="wrap">
    <!-- HERO -->
    <section id="home" class="hero">
      <div class="heroInner">
        <h1 class="title" id="headline">One stop for your <span class="accent">future</span></h1>
        <div class="badge" id="heroBadge">Sertifikat TOEFL & Komputer • Bantuan Mahasiswa • Lainnya</div>
        <p class="subhead" id="subhead"></p>

        <div class="heroActions">
          <a class="btn primary" href="#daftar" id="ctaHero">Konsultasi Gratis</a>
          <a class="btn" href="#layanan">Lihat Layanan</a>
          <a class="btn" id="igBtn" target="_blank" rel="noreferrer">Instagram</a>
        </div>
      </div>
    </section>

    <!-- ABOUT -->
    <section id="about">
      <div class="secHead">
        <h2 id="aboutTitle">Tentang Kami</h2>
      </div>
      <div class="aboutCard">
        <p class="cardText" id="aboutText"></p>
      </div>
    </section>

    <!-- SERVICES -->
    <section id="layanan">
      <div class="secHead">
        <h2>Layanan</h2>
        <div class="small">Klik card untuk lihat detail.</div>
      </div>
      <div class="svcGrid" id="svcGrid"></div>
    </section>

    <!-- ADVANTAGES -->
    <section id="keunggulan">
      <div class="secHead">
        <h2>Keunggulan</h2>
        <div class="small">Kenapa banyak yang cocok di sini.</div>
      </div>
      <div class="advGrid" id="advWrap"></div>
    </section>

    <!-- TESTIMONIALS -->
    <section id="testimoni">
      <div class="secHead">
        <h2>Testimoni</h2>
        <div class="small">Teks dan screenshot (tanpa blur).</div>
      </div>

      <div class="tWrap">
        <div class="tTrack" id="tTrack"></div>
      </div>
      <div class="tCtrls">
        <div class="iconBtn" id="tPrev" title="Prev">‹</div>
        <div class="iconBtn" id="tNext" title="Next">›</div>
      </div>

      <div style="height:18px"></div>

      <div id="galleryEmpty" class="small" style="display:none">Belum ada testimoni gambar.</div>
      <div id="galleryWrap">
        <div class="gallery">
          <div>
            <div class="bigFrame" id="bigFrame" title="Klik untuk popup">
              <img id="bigImg" alt="testimoni" />
            </div>
            <div class="cap" id="bigCap"></div>
          </div>
          <div class="thumbs" id="thumbRow"></div>
        </div>
      </div>
    </section>

    <!-- CONTACT -->
    <section id="kontak">
      <div class="secHead">
        <h2>Kontak</h2>
        <div class="small">Isi form, nanti kami hubungi via WhatsApp.</div>
      </div>
      <div class="card">
        <form id="leadForm" class="formCard">
          <div>
            <label>Nama</label>
            <input id="fName" name="name" placeholder="Nama kamu" required />
          </div>
          <div>
            <label>No WhatsApp</label>
            <input id="fWA" name="whatsapp" placeholder="08xxxxxxxxxx" required />
          </div>
          <div class="full">
            <label>Layanan</label>
            <select id="fService" name="service" required></select>
          </div>
          <div class="full">
            <label>Catatan (opsional)</label>
            <textarea id="fNote" name="note" placeholder=""></textarea>
          </div>
          <div class="full">
            <button class="btn primary" type="submit" id="btnSubmit">Kirim</button>
          </div>
        </form>
        <div class="hint" id="formHint"></div>
      </div>
    </section>

    <!-- DAFTAR anchor -->
    <section id="daftar" style="padding-top:0"></section>
  </main>

  <!-- Service Modal -->
  <div class="overlay" id="svcOverlay">
    <div class="modal">
      <div class="modalTop">
        <div>
          <h3 id="svcModalTitle"></h3>
          <p class="modalP" id="svcModalDesc"></p>
        </div>
        <div class="closeX" id="svcClose">Tutup</div>
      </div>
      <div id="svcModalBody"></div>
    </div>
  </div>

  <!-- Gallery Popup -->
  <div class="overlay" id="gOverlay">
    <div class="modal">
      <div class="modalTop">
        <div>
          <h3>Testimoni</h3>
          <p class="modalP" id="gCaption"></p>
        </div>
        <div class="closeX" id="gClose">Tutup</div>
      </div>
      <img class="gImg" id="gPopupImg" alt="popup" />
      <div class="gActions">
        <button class="btn" id="gPrev">Prev</button>
        <button class="btn" id="gNext">Next</button>
      </div>
    </div>
  </div>

  <!-- Admin FAB -->
  <div class="adminFab" id="adminFab" title="Admin"><span>A</span></div>

  <!-- Admin Overlay -->
  <div class="overlay" id="adminOverlay">
    <div class="adminPanel">
      <div class="modalTop">
        <div>
          <h3>Admin Panel (Local Draft)</h3>
          <p class="modalP">Edit di sini → <b>Copy JSON</b> → paste ke <span class="mono">data.json</span> di GitHub → commit.</p>
        </div>
        <div class="closeX" id="adminClose">Tutup</div>
      </div>

      <!-- Login -->
      <div id="adminLogin">
        <div class="adminGrid">
          <div class="full">
            <div class="chip">Keamanan: password admin tersimpan di perangkat kamu (LocalStorage). Tidak ikut ke repo.</div>
          </div>
          <div class="full">
            <label>Password Admin</label>
            <input id="adminPass" type="password" placeholder="Masukkan password" />
          </div>
          <div class="full kRow">
            <button class="btn primary" id="adminLoginBtn" type="button">Masuk</button>
            <span class="small" id="adminLoginMsg"></span>
          </div>
        </div>
      </div>

      <!-- Editor -->
      <div id="adminEditor" style="display:none">
        <div class="adminGrid">
          <div class="full kRow">
            <span class="chip">Draft tersimpan otomatis di browser kamu</span>
            <button class="btn" id="adminResetDraft" type="button">Reset Draft</button>
            <button class="btn primary" id="adminCopyJson" type="button">Copy JSON</button>
          </div>

          <div class="full">
            <label>Logo Path (contoh: assets/logo.png)</label>
            <input id="eLogoSrc" placeholder="assets/logo.png" />
          </div>

          <div>
            <label>Site Name</label>
            <input id="eSiteName" />
          </div>
          <div>
            <label>CTA Text</label>
            <input id="eCtaText" />
          </div>

          <div class="full">
            <label>Headline</label>
            <input id="eHeadline" />
          </div>
          <div class="full">
            <label>Subhead</label>
            <textarea id="eSubhead"></textarea>
          </div>

          <div class="full">
            <label>Hero Badge (boleh kosong kalau mau clean)</label>
            <input id="eHeroBadge" />
          </div>

          <div class="full">
            <label>Instagram URL</label>
            <input id="eInstagram" />
          </div>

          <div class="full">
            <label>About Title</label>
            <input id="eAboutTitle" />
          </div>
          <div class="full">
            <label>About Text</label>
            <textarea id="eAboutText"></textarea>
          </div>

          <div class="full">
            <label>Services (JSON)</label>
            <textarea id="eServices" class="mono" placeholder='[{"id":"toefl","title":"...","desc":"...","details":["SECTION: ...","..."]}]'></textarea>
            <div class="small">Tip: Untuk badge nasional/internasional, pakai item: <span class="mono">SECTION: SERTIFIKAT NASIONAL</span></div>
          </div>

          <div class="full">
            <label>Advantages (JSON)</label>
            <textarea id="eAdvantages" class="mono" placeholder='[{"title":"...","text":"..."}]'></textarea>
          </div>

          <div class="full">
            <label>Testimonials Text (JSON)</label>
            <textarea id="eTText" class="mono" placeholder='[{"name":"Anon","text":"..."}]'></textarea>
          </div>

          <div class="full">
            <label>Testimonials Images (JSON)</label>
            <textarea id="eTImg" class="mono" placeholder='[{"src":"assets/testimonials/img-01.jpg.jpeg","cap":"..."}]'></textarea>
          </div>

          <div class="full">
            <label>Ganti Password Admin</label>
            <div class="adminGrid">
              <div>
                <label>Password lama</label>
                <input id="oldPass" type="password" />
              </div>
              <div>
                <label>Password baru</label>
                <input id="newPass" type="password" />
              </div>
              <div class="full kRow">
                <button class="btn" id="btnChangePass" type="button">Ubah Password</button>
                <span class="small" id="passMsg"></span>
              </div>
            </div>
          </div>

          <div class="full">
            <div class="chip">Email tujuan tidak ditampilkan di website. Form pakai Formspree endpoint di data.json.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    // ===== Helpers
    const $ = (id)=>document.getElementById(id);

    function safeText(s){
      return (s ?? "").toString()
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function toast(msg){
      const t = $("toast");
      t.textContent = msg;
      t.style.display = "block";
      clearTimeout(toast._t);
      toast._t = setTimeout(()=>t.style.display="none", 2200);
    }

    function getImgSrc(it){ return it?.src || it?.data || ""; }

    // ===== Data State
    const LS_DRAFT = "jokitoefl_draft_v1";
    const LS_ADMIN_PASS = "jokitoefl_admin_pass_v1";
    let REMOTE = null;
    let STATE = null;

    // ===== Load data.json
    async function fetchRemote(){
      try{
        const res = await fetch("data.json?ts=" + Date.now(), { cache:"no-store" });
        if(!res.ok) return null;
        return await res.json();
      }catch(e){
        console.error(e);
        return null;
      }
    }

    function loadDraft(){
      try{
        const raw = localStorage.getItem(LS_DRAFT);
        if(!raw) return null;
        return JSON.parse(raw);
      }catch(e){ return null; }
    }

    function saveDraft(d){
      localStorage.setItem(LS_DRAFT, JSON.stringify(d));
    }

    // ===== Apply Theme
    function applyTheme(d){
      const th = d?.settings?.theme || {};
      if(th.navy) document.documentElement.style.setProperty("--navy", th.navy);
      if(th.accent) document.documentElement.style.setProperty("--sky", th.accent);
      if(th.black) document.documentElement.style.setProperty("--black", th.black);
      if(th.white) document.documentElement.style.setProperty("--white", th.white);
      if(d?.settings?.maxWidth) document.documentElement.style.setProperty("--maxw", String(d.settings.maxWidth) + "px");
    }

    // ===== Logo
    function applyLogo(d){
      const img = $("logoImg");
      const box = $("logoBox");
      const logoData = d?.settings?.logoData || "";
      const logoSrc  = d?.settings?.logo?.src || d?.settings?.logoSrc || "";
      const finalSrc = (logoData && String(logoData).startsWith("data:image")) ? logoData : logoSrc;

      if(finalSrc){
        img.src = finalSrc;
        img.style.display = "block";
        box.style.background = "transparent";
      }else{
        img.removeAttribute("src");
        img.style.display = "none";
        box.style.background = "linear-gradient(135deg, rgba(161,192,248,.90), rgba(161,192,248,.25))";
      }
    }

    // ===== Nav
    function renderNav(d){
      const nav = Array.isArray(d.nav) ? d.nav : [];
      const links = $("navLinks");
      links.innerHTML = nav.map(n=>`<a href="#${safeText(n.id)}">${safeText(n.label)}</a>`).join("");
    }

    // ===== Hero/About
    function renderHero(d){
      $("siteName").textContent = d?.settings?.siteName || "Jokitoefl.myid";
      $("tagline").textContent = d?.settings?.headline || "";
      // headline with highlightWord
      const headline = d?.settings?.headline || "";
      const hw = (d?.settings?.highlightWord || "").trim();
      if(hw && headline.toLowerCase().includes(hw.toLowerCase())){
        const idx = headline.toLowerCase().indexOf(hw.toLowerCase());
        const a = headline.slice(0, idx);
        const b = headline.slice(idx, idx+hw.length);
        const c = headline.slice(idx+hw.length);
        $("headline").innerHTML = `${safeText(a)}<span class="accent">${safeText(b)}</span>${safeText(c)}`;
      }else{
        $("headline").textContent = headline || "One stop for your future";
      }

      const hb = (d?.settings?.heroBadge ?? "").toString().trim();
      if(hb){
        $("heroBadge").style.display = "inline-flex";
        $("heroBadge").textContent = hb;
      }else{
        $("heroBadge").style.display = "none";
      }

      $("subhead").textContent = d?.settings?.subhead || "";
      $("ctaHero").textContent = d?.settings?.ctaText || "Konsultasi Gratis";
      $("igBtn").href = d?.settings?.instagram || "#";
    }

    function renderAbout(d){
      $("aboutTitle").textContent = d?.about?.title || "Tentang Kami";
      $("aboutText").textContent = d?.about?.text || "";
    }

    // ===== Services + Modal
    let currentServices = [];
    let currentServiceTitle = "";

    function renderServices(d){
      const services = Array.isArray(d.services) ? d.services : [];
      currentServices = services;

      const grid = $("svcGrid");
      grid.innerHTML = "";

      if(!services.length){
        grid.innerHTML = `<div class="small">Belum ada layanan.</div>`;
        return;
      }

      services.forEach(s=>{
        const card = document.createElement("div");
        card.className = "card svcCard";
        card.innerHTML = `
          <div class="cardTitle">${safeText(s.title || "")}</div>
          <p class="cardText">${safeText(s.desc || "")}</p>
        `;
        card.onclick = ()=>openServiceModal(s);
        grid.appendChild(card);
      });

      // form service options
      const sel = $("fService");
      sel.innerHTML = services.map(s=>`<option value="${safeText(s.title||"")}">${safeText(s.title||"")}</option>`).join("");
    }

    function openServiceModal(s){
      $("svcModalTitle").textContent = s?.title || "";
      $("svcModalDesc").textContent  = s?.desc || "";
      const body = $("svcModalBody");
      body.innerHTML = "";

      const details = s?.details;
      const det = Array.isArray(details) ? details : [];

      const isObjSection = (v) =>
        v && typeof v === "object" && !Array.isArray(v) && ("title" in v || "items" in v);

      const renderSection = (title, items) => {
        const div = document.createElement("div");
        div.className = "modalSection";

        const safeTitle = (title ?? "").toString().trim();
        const li = (items || [])
          .map(x => (x ?? "").toString().trim())
          .filter(Boolean)
          .map(x => `<li>${safeText(x)}</li>`)
          .join("");

        const badge = safeTitle ? `<div class="modalBadge">${safeText(safeTitle)}</div>` : "";
        div.innerHTML = `${badge}<ul>${li || `<li class="muted">Detail belum ditambahkan.</li>`}</ul>`;
        body.appendChild(div);
      };

      if(det.length && isObjSection(det[0])){
        det.forEach(sec => renderSection(sec.title || "", Array.isArray(sec.items) ? sec.items : []));
      }else if(det.length && typeof det[0] === "string"){
        const lines = det.map(x => (x ?? "").toString().trim()).filter(Boolean);
        const hasSection = lines.some(l => /^SECTION:\s*/i.test(l));
        if(hasSection){
          const sections = [];
          let currentTitle = "";
          let currentItems = [];
          const push = ()=>{
            if(currentTitle || currentItems.length) sections.push({title:currentTitle, items:currentItems});
            currentTitle = ""; currentItems = [];
          };
          lines.forEach(line=>{
            const m = line.match(/^SECTION:\s*(.+)$/i);
            if(m){ push(); currentTitle = (m[1]||"").trim(); }
            else{ currentItems.push(line); }
          });
          push();
          if(sections.length) sections.forEach(sec=>renderSection(sec.title, sec.items));
          else renderSection("Detail", lines);
        }else{
          renderSection("Detail", lines);
        }
      }else{
        renderSection("Detail", []);
      }

      $("svcOverlay").style.display = "flex";
    }

    $("svcClose").onclick = ()=> $("svcOverlay").style.display = "none";
    $("svcOverlay").addEventListener("click", (e)=>{ if(e.target.id==="svcOverlay") $("svcOverlay").style.display="none"; });

    // ===== Advantages
    function renderAdvantages(d){
      const wrap = $("advWrap");
      if(!wrap) return;
      const list = Array.isArray(d.advantages) ? d.advantages : [];
      wrap.innerHTML = "";

      if(!list.length){
        wrap.innerHTML = `<div class="small">Belum ada data keunggulan.</div>`;
        return;
      }

      list.forEach(item=>{
        const card = document.createElement("div");
        card.className = "advCard";
        card.innerHTML = `
          <h3 class="advTitle">${safeText(item.title || "")}</h3>
          <p class="advText">${safeText(item.text || "")}</p>
        `;
        wrap.appendChild(card);
      });
    }

    // ===== Testimonials Text Slider (manual + swipe)
    let tIndex = 0;
    function renderTestimonialsText(d){
      const arr = Array.isArray(d.testimonialsText) ? d.testimonialsText : [];
      const track = $("tTrack");
      track.innerHTML = "";

      if(!arr.length){
        track.innerHTML = `<div class="small">Belum ada testimoni teks.</div>`;
        return;
      }

      arr.forEach(x=>{
        const el = document.createElement("div");
        el.className = "tCard";
        el.innerHTML = `<div class="tName">${safeText(x.name || "Anon")}</div><p class="tText">${safeText(x.text || "")}</p>`;
        track.appendChild(el);
      });

      tIndex = 0;
      updateT();
    }

    function updateT(){
      const track = $("tTrack");
      const cards = track.children;
      if(!cards.length) return;

      const card = cards[0];
      const w = card.getBoundingClientRect().width + 14; // gap
      // show 2.5 on desktop: we just shift by 1 card each click
      const x = Math.max(0, tIndex) * w;
      track.style.transform = `translateX(${-x}px)`;
    }

    $("tPrev").onclick = ()=>{
      tIndex = Math.max(0, tIndex - 1);
      updateT();
    };
    $("tNext").onclick = ()=>{
      const track = $("tTrack");
      const count = track.children.length || 0;
      tIndex = Math.min(Math.max(0, count - 1), tIndex + 1);
      updateT();
    };

    // swipe
    (function bindSwipe(){
      const area = $("tTrack");
      let startX = 0, dx = 0, down = false;

      area.addEventListener("touchstart", (e)=>{
        down = true;
        startX = e.touches[0].clientX;
      }, {passive:true});

      area.addEventListener("touchmove", (e)=>{
        if(!down) return;
        dx = e.touches[0].clientX - startX;
      }, {passive:true});

      area.addEventListener("touchend", ()=>{
        if(!down) return;
        down = false;
        if(dx < -35) $("tNext").click();
        if(dx > 35) $("tPrev").click();
        dx = 0;
      });
    })();

    // ===== Testimonials Images Gallery (big + thumbs + popup)
    let gIndex = 0;
    function renderGallery(d){
      const imgs = (Array.isArray(d.testimonialsImages) ? d.testimonialsImages : []).slice(0, 20);
      const bigImg = $("bigImg");
      const thumbRow = $("thumbRow");
      const empty = $("galleryEmpty");
      const wrap = $("galleryWrap");

      thumbRow.innerHTML = "";

      if(imgs.length === 0){
        wrap.style.display = "none";
        empty.style.display = "block";
        return;
      }
      wrap.style.display = "";
      empty.style.display = "none";

      gIndex = Math.max(0, Math.min(gIndex, imgs.length - 1));

      const bigSrc = getImgSrc(imgs[gIndex]);
      bigImg.src = bigSrc || "";
      $("bigCap").textContent = (imgs[gIndex].cap || "").toString();

      imgs.forEach((it, i)=>{
        const t = document.createElement("div");
        t.className = "thumb" + (i===gIndex ? " active" : "");
        const src = getImgSrc(it);
        t.innerHTML = `<img alt="thumb" src="${safeText(src)}">`;
        t.onclick = ()=>{ gIndex = i; updateGallery(d); };
        thumbRow.appendChild(t);
      });
    }

    function updateGallery(d){
      const imgs = (Array.isArray(d.testimonialsImages) ? d.testimonialsImages : []).slice(0, 20);
      if(imgs.length === 0) return;

      $("bigImg").src = getImgSrc(imgs[gIndex]) || "";
      $("bigCap").textContent = (imgs[gIndex].cap || "").toString();

      Array.from(document.querySelectorAll(".thumb"))
        .forEach((t,i)=>t.classList.toggle("active", i===gIndex));
    }

    function openGalleryPopup(d){
      const imgs = (Array.isArray(d.testimonialsImages) ? d.testimonialsImages : []).slice(0, 20);
      if(imgs.length === 0) return;

      $("gPopupImg").src = getImgSrc(imgs[gIndex]) || "";
      $("gCaption").textContent = (imgs[gIndex].cap || "").toString();
      $("gOverlay").style.display = "flex";
    }

    $("bigFrame").onclick = ()=> openGalleryPopup(STATE);
    $("gClose").onclick = ()=> $("gOverlay").style.display = "none";
    $("gOverlay").addEventListener("click", (e)=>{ if(e.target.id==="gOverlay") $("gOverlay").style.display="none"; });

    $("gPrev").onclick = ()=>{
      const imgs = (Array.isArray(STATE?.testimonialsImages) ? STATE.testimonialsImages : []).slice(0,20);
      if(!imgs.length) return;
      gIndex = (gIndex - 1 + imgs.length) % imgs.length;
      updateGallery(STATE);
      $("gPopupImg").src = getImgSrc(imgs[gIndex]) || "";
      $("gCaption").textContent = (imgs[gIndex].cap || "").toString();
    };
    $("gNext").onclick = ()=>{
      const imgs = (Array.isArray(STATE?.testimonialsImages) ? STATE.testimonialsImages : []).slice(0,20);
      if(!imgs.length) return;
      gIndex = (gIndex + 1) % imgs.length;
      updateGallery(STATE);
      $("gPopupImg").src = getImgSrc(imgs[gIndex]) || "";
      $("gCaption").textContent = (imgs[gIndex].cap || "").toString();
    };

    // ===== Form submit (Formspree)
    function applyForm(d){
      const hint = $("formHint");
      const ep = (d?.settings?.form?.formspreeEndpoint || "").toString().trim();
      const notePH = (d?.settings?.form?.notePlaceholder || "").toString();
      $("fNote").placeholder = notePH;

      if(!ep){
        hint.innerHTML = `Form belum aktif (endpoint kosong). Isi <span class="mono">settings.form.formspreeEndpoint</span> di data.json.`;
      }else{
        hint.textContent = "Setelah kamu kirim, kami akan hubungi lewat WhatsApp.";
      }

      $("leadForm").onsubmit = async (e)=>{
        e.preventDefault();
        const name = $("fName").value.trim();
        const whatsapp = $("fWA").value.trim();
        const service = $("fService").value.trim();
        const note = $("fNote").value.trim();

        if(!name || !whatsapp || !service){
          toast("Lengkapi form dulu ya.");
          return;
        }

        if(!ep){
          toast("Form belum aktif. Endpoint Formspree masih kosong.");
          return;
        }

        try{
          const res = await fetch(ep, {
            method:"POST",
            headers:{ "Content-Type":"application/json", "Accept":"application/json" },
            body: JSON.stringify({ name, whatsapp, service, note })
          });
          if(res.ok){
            toast("Terkirim. Kami akan hubungi via WhatsApp.");
            $("leadForm").reset();
          }else{
            toast("Gagal kirim. Coba lagi ya.");
          }
        }catch(err){
          console.error(err);
          toast("Gagal kirim. Cek koneksi.");
        }
      };
    }

    // ===== Admin (local only)
    function getAdminPass(){
      let p = localStorage.getItem(LS_ADMIN_PASS);
      // If never set, force user to create on first login attempt:
      return p || "";
    }
    function setAdminPass(p){
      localStorage.setItem(LS_ADMIN_PASS, p);
    }

    function openAdmin(){
      $("adminOverlay").style.display = "flex";
      $("adminLoginMsg").textContent = "";
      $("adminPass").value = "";
      $("passMsg").textContent = "";
      // show login by default
      $("adminLogin").style.display = "";
      $("adminEditor").style.display = "none";
    }
    function closeAdmin(){ $("adminOverlay").style.display = "none"; }

    $("adminFab").onclick = openAdmin;
    $("adminClose").onclick = closeAdmin;
    $("adminOverlay").addEventListener("click", (e)=>{ if(e.target.id==="adminOverlay") closeAdmin(); });

    function fillAdminEditor(d){
      $("eLogoSrc").value = d?.settings?.logo?.src || "";
      $("eSiteName").value = d?.settings?.siteName || "";
      $("eCtaText").value = d?.settings?.ctaText || "";
      $("eHeadline").value = d?.settings?.headline || "";
      $("eSubhead").value = d?.settings?.subhead || "";
      $("eHeroBadge").value = d?.settings?.heroBadge || "";
      $("eInstagram").value = d?.settings?.instagram || "";

      $("eAboutTitle").value = d?.about?.title || "";
      $("eAboutText").value  = d?.about?.text || "";

      $("eServices").value = JSON.stringify(Array.isArray(d.services)?d.services:[], null, 2);
      $("eAdvantages").value = JSON.stringify(Array.isArray(d.advantages)?d.advantages:[], null, 2);
      $("eTText").value = JSON.stringify(Array.isArray(d.testimonialsText)?d.testimonialsText:[], null, 2);
      $("eTImg").value  = JSON.stringify(Array.isArray(d.testimonialsImages)?d.testimonialsImages:[], null, 2);
    }

    function readAdminEditor(){
      const out = structuredClone(STATE || {});
      out.settings = out.settings || {};
      out.settings.logo = out.settings.logo || {};

      out.settings.logo.src = $("eLogoSrc").value.trim();
      out.settings.siteName = $("eSiteName").value.trim();
      out.settings.ctaText  = $("eCtaText").value.trim();
      out.settings.headline = $("eHeadline").value.trim();
      out.settings.subhead  = $("eSubhead").value.trim();
      out.settings.heroBadge = $("eHeroBadge").value.trim();
      out.settings.instagram = $("eInstagram").value.trim();

      out.about = out.about || {};
      out.about.title = $("eAboutTitle").value.trim();
      out.about.text  = $("eAboutText").value.trim();

      // JSON fields
      const parseJson = (elId, fallback)=>{
        try{
          const v = $(elId).value.trim();
          if(!v) return fallback;
          return JSON.parse(v);
        }catch(e){
          toast("JSON error di " + elId);
          throw e;
        }
      };

      out.services = parseJson("eServices", []);
      out.advantages = parseJson("eAdvantages", []);
      out.testimonialsText = parseJson("eTText", []);
      out.testimonialsImages = parseJson("eTImg", []);

      return out;
    }

    function bindAdminAutosave(){
      const ids = ["eLogoSrc","eSiteName","eCtaText","eHeadline","eSubhead","eHeroBadge","eInstagram","eAboutTitle","eAboutText","eServices","eAdvantages","eTText","eTImg"];
      ids.forEach(id=>{
        $(id).addEventListener("input", ()=>{
          try{
            const d = readAdminEditor();
            saveDraft(d);
            toast("Draft tersimpan (local).");
          }catch(e){
            // keep editor as-is
          }
        });
      });
    }

    $("adminLoginBtn").onclick = ()=>{
      const input = $("adminPass").value;
      const saved = getAdminPass();

      // If never set, first login sets the password
      if(!saved){
        if(!input || input.length < 6){
          $("adminLoginMsg").textContent = "Buat password minimal 6 karakter.";
          return;
        }
        setAdminPass(input);
        $("adminLoginMsg").textContent = "Password dibuat. Masuk...";
      }else{
        if(input !== saved){
          $("adminLoginMsg").textContent = "Password salah.";
          return;
        }
      }

      $("adminLogin").style.display = "none";
      $("adminEditor").style.display = "";
      fillAdminEditor(STATE);
      bindAdminAutosave();
      toast("Admin aktif (draft lokal).");
    };

    $("btnChangePass").onclick = ()=>{
      const oldP = $("oldPass").value;
      const newP = $("newPass").value;
      const saved = getAdminPass();

      if(!saved){
        $("passMsg").textContent = "Belum ada password. Login dulu untuk membuat.";
        return;
      }
      if(oldP !== saved){
        $("passMsg").textContent = "Password lama salah.";
        return;
      }
      if(!newP || newP.length < 6){
        $("passMsg").textContent = "Password baru minimal 6 karakter.";
        return;
      }
      setAdminPass(newP);
      $("oldPass").value = "";
      $("newPass").value = "";
      $("passMsg").textContent = "Password berhasil diubah.";
      toast("Password admin diubah.");
    };

    $("adminCopyJson").onclick = async ()=>{
      try{
        const d = readAdminEditor();
        const text = JSON.stringify(d, null, 2);
        await navigator.clipboard.writeText(text);
        toast("JSON tersalin. Paste ke data.json di GitHub lalu commit.");
      }catch(e){
        console.error(e);
        toast("Gagal copy. Cek JSON editor.");
      }
    };

    $("adminResetDraft").onclick = ()=>{
      localStorage.removeItem(LS_DRAFT);
      toast("Draft dihapus. Reload untuk kembali ke data.json publik.");
    };

    // ===== Render all
    function applyAll(d){
      applyTheme(d);
      applyLogo(d);
      renderNav(d);
      renderHero(d);
      renderAbout(d);
      renderServices(d);
      renderAdvantages(d);
      renderTestimonialsText(d);
      renderGallery(d);
      applyForm(d);
    }

    // ===== Boot
    (async function(){
      REMOTE = await fetchRemote();
      if(!REMOTE){
        // minimal fallback: still shows page structure
        REMOTE = {
          version: 1,
          settings: { siteName:"Jokitoefl.myid", headline:"One stop for your future", highlightWord:"future", subhead:"", heroBadge:"", ctaText:"Konsultasi Gratis", instagram:"#", maxWidth:1100, theme:{} , logo:{src:""} , form:{provider:"formspree", formspreeEndpoint:"", notePlaceholder:""} },
          nav: [{id:"home",label:"Home"},{id:"about",label:"About"},{id:"layanan",label:"Layanan"},{id:"testimoni",label:"Testimoni"},{id:"kontak",label:"Kontak"}],
          about: {title:"Tentang Kami", text:""},
          services: [],
          advantages: [],
          testimonialsText: [],
          testimonialsImages: []
        };
        toast("Gagal load data.json. Cek file di repo.");
      }

      const draft = loadDraft();
      STATE = draft || REMOTE;
      applyAll(STATE);
    })();
  </script>
</body>
</html>
